<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RigNavi MVP</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  :root{
    /* æ˜ã‚‹ã‚ï¼†ä»Šã£ã½ã„æµ·é…è‰² */
    --bg1:#eff9ff; --bg2:#e9f5ff;
    --ink:#0b2531; --muted:#5a7b8c;
    --glass:#ffffffc9; --line:#d8e9f3;
    --card:#ffffff; --chip:#f4faff;
    --accent:#12b6ff; --accent-ink:#013449;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
  }
  header{
    position:sticky; top:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px; backdrop-filter:saturate(140%) blur(10px);
    background:var(--glass); border-bottom:1px solid var(--line);
  }
  .brand{font-weight:800; letter-spacing:.1px; display:flex; gap:8px; align-items:center}
  .brand i{font-style:normal; font-size:18px}
  .badge{background:#d6f4ff; color:#067; padding:6px 10px; border-radius:999px; font-size:12px}
  main{max-width:980px; margin:0 auto; padding:16px}
  #hello{margin:4px 0 16px; color:var(--muted)}
  .steps{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
  .step{border:1px solid var(--line); background:var(--chip); color:var(--muted);
        border-radius:12px; padding:8px 12px; font-size:13px}
  .step.on{border-color:#bfe9ff; color:#0a4c63; background:#e8f8ff; font-weight:700}
  #back{appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink);
        padding:10px 14px; border-radius:10px}
  #back[hidden]{display:none}

  .grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:16px;
    padding:16px; box-shadow:0 10px 22px rgba(23,70,96,.08);
  }
  h1,h2,h3{margin:.2em 0 .5em}
  h1{font-size:26px} h3{font-size:18px}
  .muted{color:var(--muted)}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .chips{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
  .chip,button{appearance:none; border:none; cursor:pointer; border-radius:12px; padding:12px 14px; font-size:15px}
  .chip{background:var(--chip)}
  button.pri{background:var(--accent); color:var(--accent-ink); font-weight:800}
  button.ghost{background:#fff; border:1px solid var(--line)}
  a{color:#007fb3}
  ul.items{padding-left:18px; margin:8px 0}
  ul.items li{margin:10px 0}
  .kv{display:flex; gap:10px; flex-wrap:wrap; margin:.6rem 0}
  .kv span{background:#f6fbff; border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:12px}
  .hero{background:linear-gradient(135deg,#e8f7ff,#ffffff); border:1px dashed var(--line); border-radius:16px; padding:12px; margin-bottom:12px}
  .banner{width:100%; border-radius:14px; border:1px solid var(--line); display:block}
  .shops{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
  .shop{padding:8px 10px; border-radius:10px; background:#fff; border:1px solid var(--line); font-size:14px}
  .cap{font-size:13px; color:var(--muted); margin:4px 0 8px}
  .sectionTitle{margin-top:12px; margin-bottom:6px; font-weight:800}
</style>
</head>
<body>
<header>
  <div class="brand"><i>ğŸ£</i>RigNavi</div>
  <div class="badge">MVP</div>
</header>

<main>
  <div id="hello">èµ·å‹•ä¸­â€¦</div>

  <div class="row" style="justify-content:space-between">
    <div class="steps" id="steps"></div>
    <button id="back" class="ghost" hidden onclick="goBack()">æˆ»ã‚‹</button>
  </div>

  <div id="app"></div>
</main>

<script>
/* ===== åŸºæœ¬è¨­å®š ===== */
const LIFF_ID = "2008257307-RwPLYWG1";
const VERSION = "9";

/* ===== é­šç¨®â†’è¨±å¯é‡£æ³•ï¼ˆè‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ ===== */
const FISH_METHODS = {
  "ã‚¢ã‚¸":      ["ã‚µãƒ“ã‚­","ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­","ã¡ã‚‡ã„æŠ•ã’","ã‚¦ã‚­"],     // ç©´é‡£ã‚Š/ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã¯éè¡¨ç¤º
  "ã‚«ã‚µã‚´":    ["ç©´é‡£ã‚Š","èƒ´çªã","ãƒ–ãƒ©ã‚¯ãƒª","ã‚¦ã‚­"],               // ãƒ«ã‚¢ãƒ¼ã¯éæ¨å¥¨ãªã®ã§å¤–ã™
  "ãƒ¡ãƒãƒ«":    ["ã‚¦ã‚­","èƒ´çªã","ãƒ«ã‚¢ãƒ¼(è»½é‡)"],
  "ã‚·ãƒ¼ãƒã‚¹":  ["ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­"],                                   // ä¸»è»¸ã¯ãƒ«ã‚¢ãƒ¼
  "ã‚¤ã‚·ãƒ¢ãƒ":  ["ã¡ã‚‡ã„æŠ•ã’","èƒ´çªã"],
  "ã‚³ãƒã‚·ãƒ­":  ["ã‚µãƒ“ã‚­","ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­"],
  "ãƒã‚¼":      ["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","ã¡ã‚‡ã„æŠ•ã’"],
  "ã‚¯ãƒ­ãƒ€ã‚¤":  ["ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ã¶ã£ã“ã¿","ãƒ•ã‚«ã‚»"],
  "ãƒ†ãƒŠã‚¬ã‚¨ãƒ“":["ãƒŸãƒ£ã‚¯é‡£ã‚Š","å°ã‚¦ã‚­"],
  "ãƒ˜ãƒ©ãƒ–ãƒŠ":  ["ã‚¦ã‚­ï¼ˆã‚¨ã‚µé‡£ã‚Šï¼‰"],
  "ãƒã‚´ãƒ":    ["ãƒ«ã‚¢ãƒ¼","ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼"],                          // ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼æƒ³å®š
  "ã‚»ã‚¤ã‚´":    ["ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­"]
};

/* ===== é­šç”»åƒï¼ˆä»®ï¼‰ ===== */
const FISH_IMAGES = {
  "ã‚¢ã‚¸":"https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?q=80&w=1200&auto=format&fit=crop",
  "ã‚«ã‚µã‚´":"https://images.unsplash.com/photo-1558981359-219d6364c9cc?q=80&w=1200&auto=format&fit=crop",
  "ãƒ¡ãƒãƒ«":"https://images.unsplash.com/photo-1524704654690-b56c05c78a00?q=80&w=1200&auto=format&fit=crop",
  "ã‚·ãƒ¼ãƒã‚¹":"https://images.unsplash.com/photo-1526481280698-8fcc13fd3b5d?q=80&w=1200&auto=format&fit=crop",
  "ãƒã‚¼":"https://images.unsplash.com/photo-1544551763-7ef25f88c5f5?q=80&w=1200&auto=format&fit=crop",
  "ã‚¯ãƒ­ãƒ€ã‚¤":"https://images.unsplash.com/photo-1546868871-7041f2a55e12?q=80&w=1200&auto=format&fit=crop",
  "ãƒ†ãƒŠã‚¬ã‚¨ãƒ“":"https://images.unsplash.com/photo-1504707748692-419802cf939d?q=80&w=1200&auto=format&fit=crop",
  "ãƒ˜ãƒ©ãƒ–ãƒŠ":"https://images.unsplash.com/photo-1464925257126-6450e871c667?q=80&w=1200&auto=format&fit=crop",
  "ãƒã‚´ãƒ":"https://images.unsplash.com/photo-1461354464878-ad92f492a5a0?q=80&w=1200&auto=format&fit=crop",
  "ã‚¤ã‚·ãƒ¢ãƒ":"https://images.unsplash.com/photo-1498654200943-1088dd4438ae?q=80&w=1200&auto=format&fit=crop",
  "ã‚³ãƒã‚·ãƒ­":"https://images.unsplash.com/photo-1534088568595-a066f410bcda?q=80&w=1200&auto=format&fit=crop",
  "ã‚»ã‚¤ã‚´":"https://images.unsplash.com/photo-1531959870249-9d3f62f96f22?q=80&w=1200&auto=format&fit=crop"
};
/* ä»»æ„ï¼šimg/fish-xxx.png ã‚’ç½®ã‘ã°è‡ªå‹•ã§ãã¡ã‚‰ã‚’å„ªå…ˆè¡¨ç¤º */
function fishImg(f){ const local=`img/fish-${toSlug(f)}.png`; return localExistsHint(local) || FISH_IMAGES[f] || null; }

/* ===== ä»•æ›ã‘ã‚¤ãƒ©ã‚¹ãƒˆï¼ˆä»®ï¼‰ =====
   1) img/rig-<fish>-<method>.png ãŒã‚ã‚Œã°ãã‚Œã‚’
   2) ãªã‘ã‚Œã° method ã®æ±ç”¨
   3) ãã‚Œã‚‚ç„¡ã‘ã‚Œã°ãƒ€ãƒŸãƒ¼ç”»åƒ */
const RIG_DEFAULT_BY_METHOD = {
  "ã‚µãƒ“ã‚­":"https://placehold.co/1200x600?text=Sabiki+Rig+Guide",
  "ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­":"https://placehold.co/1200x600?text=Rocket+Sabiki+Rig",
  "ã¡ã‚‡ã„æŠ•ã’":"https://placehold.co/1200x600?text=Light+Surf+Rig",
  "èƒ´çªã":"https://placehold.co/1200x600?text=Dropper+Loop+Rig",
  "ãƒ–ãƒ©ã‚¯ãƒª":"https://placehold.co/1200x600?text=Burakuri+Rig",
  "ã‚¦ã‚­":"https://placehold.co/1200x600?text=Float+Rig",
  "ãƒŸãƒ£ã‚¯é‡£ã‚Š":"https://placehold.co/1200x600?text=Keiryu/Miyakuzuri",
  "ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿":"https://placehold.co/1200x600?text=Heci+Otoshikomi",
  "ãƒ«ã‚¢ãƒ¼":"https://placehold.co/1200x600?text=Lure+Setup",
  "ãƒ«ã‚¢ãƒ¼(è»½é‡)":"https://placehold.co/1200x600?text=Light+Game+Setup",
  "ã¶ã£ã“ã¿":"https://placehold.co/1200x600?text=Bottom+Rig",
  "ãƒ•ã‚«ã‚»":"https://placehold.co/1200x600?text=Float+Drift+(Fukase)",
  "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼":"https://placehold.co/1200x600?text=Elevator+Rig",
  "å°ã‚¦ã‚­":"https://placehold.co/1200x600?text=Small+Float+Rig",
  "ã‚¦ã‚­ï¼ˆã‚¨ã‚µé‡£ã‚Šï¼‰":"https://placehold.co/1200x600?text=Float+Bait"
};
function rigImg(fish,method){
  const m = method || "";
  const localSpecific = `img/rig-${toSlug(fish)}-${toSlug(m)}.png`;
  const localGeneric  = `img/rig-${toSlug(m)}.png`;
  return localExistsHint(localSpecific) || localExistsHint(localGeneric) || RIG_DEFAULT_BY_METHOD[m] || "https://placehold.co/1200x600?text=Rig+Illustration";
}
/* è£œåŠ©ï¼šå®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨åˆ¤å®šã¯å‡ºæ¥ãªã„ã®ã§ã€å¸¸ã«ãƒ‘ã‚¹ã‚’è¿”ã— onerror ã§éè¡¨ç¤ºå‡¦ç† */
function localExistsHint(path){ return path; }

/* ===== é­šç¨®â†’ã‚®ã‚¢ï¼ˆAmazon/Rakutenï¼‰ ===== */
const LINKS_BY_FISH = {
  "ã‚¢ã‚¸":[
    {label:"ãƒˆãƒªãƒƒã‚¯ã‚µãƒ“ã‚­ #6ã€œ8", a:"https://www.amazon.co.jp/s?k=%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF+%E3%82%B5%E3%83%93%E3%82%AD&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF+%E3%82%B5%E3%83%93%E3%82%AD/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ã‚¢ãƒŸã‚³ãƒã‚»ï¼ˆãƒ‘ãƒƒã‚¯ï¼‰",   a:"https://www.amazon.co.jp/s?k=%E3%82%A2%E3%83%9F+%E3%82%B3%E3%83%9E%E3%82%BB&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%82%A2%E3%83%9F+%E3%82%B3%E3%83%9E%E3%82%BB/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚«ã‚µã‚´":[
    {label:"ãƒ–ãƒ©ã‚¯ãƒª 5ã€œ8å·",       a:"https://www.amazon.co.jp/s?k=%E3%83%96%E3%83%A9%E3%82%AF%E3%83%AA&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%96%E3%83%A9%E3%82%AF%E3%83%AA/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"æ ¹é­šãƒ¯ãƒ¼ãƒ  2inch",      a:"https://www.amazon.co.jp/s?k=%E6%A0%B9%E9%AD%9A+%E3%83%AF%E3%83%BC%E3%83%A0&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E6%A0%B9%E9%AD%9A+%E3%83%AF%E3%83%BC%E3%83%A0/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚·ãƒ¼ãƒã‚¹":[
    {label:"ãƒŸãƒãƒ¼ 9ã€œ12cm",        a:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%9F%E3%83%8E%E3%83%BC&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%9F%E3%83%8E%E3%83%BC/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ãƒã‚¤ãƒ– 14ã€œ20g",        a:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%90%E3%82%A4%E3%83%96&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%90%E3%82%A4%E3%83%96/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒã‚¼":[
    {label:"ã®ã¹ç«¿2.7mï¼‹å°éˆ",      a:"https://www.amazon.co.jp/s?k=%E3%81%AE%E3%81%B9%E7%AB%BF+2.7m&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%81%AE%E3%81%B9%E7%AB%BF+2.7m/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ãƒŸãƒ£ã‚¯é‡£ã‚Šä»•æ›ã‘",      a:"https://www.amazon.co.jp/s?k=%E3%83%8F%E3%82%BC+%E3%83%9F%E3%83%A3%E3%82%AF%E9%87%A3%E3%82%8A&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%8F%E3%82%BC+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚¯ãƒ­ãƒ€ã‚¤":[
    {label:"è½ã¨ã—è¾¼ã¿ä¸€å¼",        a:"https://www.amazon.co.jp/s?k=%E8%90%BD%E3%81%A8%E3%81%97%E8%BE%BC%E3%81%BF+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E8%90%BD%E3%81%A8%E3%81%97%E8%BE%BC%E3%81%BF+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ†ãƒŠã‚¬ã‚¨ãƒ“":[
    {label:"ãƒ†ãƒŠã‚¬ã‚¨ãƒ“ä»•æ›ã‘",      a:"https://www.amazon.co.jp/s?k=%E3%83%86%E3%83%8A%E3%82%AC%E3%82%A8%E3%83%93+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%86%E3%83%8A%E3%82%AC%E3%82%A8%E3%83%93+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ˜ãƒ©ãƒ–ãƒŠ":[
    {label:"ã‚¦ã‚­ä»•æ›ã‘",            a:"https://www.amazon.co.jp/s?k=%E3%83%98%E3%83%A9%E3%83%96%E3%83%8A+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%98%E3%83%A9%E3%83%96%E3%83%8A+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒã‚´ãƒ":[
    {label:"ã‚¸ã‚°ãƒ˜ãƒƒãƒ‰20ã€œ30gï¼‹ãƒ¯ãƒ¼ãƒ ", a:"https://www.amazon.co.jp/s?k=%E3%83%9E%E3%82%B4%E3%83%81+%E3%83%AF%E3%83%BC%E3%83%A0&tag=YOURID-22",
                                         r:"https://search.rakuten.co.jp/search/mall/%E3%83%9E%E3%82%B4%E3%83%81+%E3%83%AF%E3%83%BC%E3%83%A0/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ]
};

/* ===== é‡£ã‚Šæ–¹â†’é¤Œ/æ’’ãé¤ŒãŠã™ã™ã‚ ===== */
const BAIT_BY_METHOD = {
  "ã‚µãƒ“ã‚­":[
    {label:"ã‚¢ãƒŸå§«ï¼ˆå¸¸æ¸©ï¼‰", a:"https://www.amazon.co.jp/s?k=%E3%82%A2%E3%83%9F%E5%A7%AB&tag=YOURID-22",
                               r:"https://search.rakuten.co.jp/search/mall/%E3%82%A2%E3%83%9F%E5%A7%AB/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ã‚³ãƒã‚»ã‚¹ãƒ—ãƒ¼ãƒ³", a:"https://www.amazon.co.jp/s?k=%E3%82%B3%E3%83%9E%E3%82%BB+%E3%82%B9%E3%83%97%E3%83%BC%E3%83%B3&tag=YOURID-22",
                               r:"https://search.rakuten.co.jp/search/mall/%E3%82%B3%E3%83%9E%E3%82%BB+%E3%82%B9%E3%83%97%E3%83%BC%E3%83%B3/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­":[
    {label:"ãƒ­ã‚±ãƒƒãƒˆã‚«ã‚´å¤©ç§¤", a:"https://www.amazon.co.jp/s?k=%E3%83%AD%E3%82%B1%E3%83%83%E3%83%88+%E3%82%AB%E3%82%B4&tag=YOURID-22",
                                 r:"https://search.rakuten.co.jp/search/mall/%E3%83%AD%E3%82%B1%E3%83%83%E3%83%88+%E3%82%AB%E3%82%B4/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ•ã‚«ã‚»":[
    {label:"ã‚ªã‚­ã‚¢ãƒŸç”Ÿ/ãƒœã‚¤ãƒ«", a:"https://www.amazon.co.jp/s?k=%E3%82%AA%E3%82%AD%E3%82%A2%E3%83%9F&tag=YOURID-22",
                                 r:"https://search.rakuten.co.jp/search/mall/%E3%82%AA%E3%82%AD%E3%82%A2%E3%83%9F/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"é…åˆã‚¨ã‚µï¼ˆã‚°ãƒ¬ç”¨ç­‰ï¼‰", a:"https://www.amazon.co.jp/s?k=%E3%83%95%E3%82%AB%E3%82%BB+%E9%85%8D%E5%90%88&tag=YOURID-22",
                                   r:"https://search.rakuten.co.jp/search/mall/%E3%83%95%E3%82%AB%E3%82%BB+%E9%85%8D%E5%90%88/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼":[
    {label:"æ´»é¤Œï¼ˆã‚¢ã‚¸ç­‰ï¼‰æ´»ã‹ã—ãƒã‚±ãƒ„", a:"https://www.amazon.co.jp/s?k=%E6%B4%BB%E3%81%8B%E3%81%97%E3%83%90%E3%82%B1%E3%83%84&tag=YOURID-22",
                                           r:"https://search.rakuten.co.jp/search/mall/%E6%B4%BB%E3%81%8B%E3%81%97%E3%83%90%E3%82%B1%E3%83%84/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ä»•æ›ã‘", a:"https://www.amazon.co.jp/s?k=%E3%82%A8%E3%83%AC%E3%83%99%E3%83%BC%E3%82%BF%E3%83%BC+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                 r:"https://search.rakuten.co.jp/search/mall/%E3%82%A8%E3%83%AC%E3%83%99%E3%83%BC%E3%82%BF%E3%83%BC+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "èƒ´çªã":[
    {label:"é’ã‚¤ã‚½ãƒ¡", a:"https://www.amazon.co.jp/s?k=%E9%9D%92%E3%82%A4%E3%82%BD%E3%83%A1&tag=YOURID-22",
                       r:"https://search.rakuten.co.jp/search/mall/%E9%9D%92%E3%82%A4%E3%82%BD%E3%83%A1/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã¶ã£ã“ã¿":[
    {label:"å¤œå…‰éˆ´/ãƒ™ãƒ«", a:"https://www.amazon.co.jp/s?k=%E5%A4%9C%E5%85%89%E9%88%B4+%E9%87%A3%E3%82%8A&tag=YOURID-22",
                         r:"https://search.rakuten.co.jp/search/mall/%E5%A4%9C%E5%85%89%E9%88%B4+%E9%87%A3%E3%82%8A/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒŸãƒ£ã‚¯é‡£ã‚Š":[
    {label:"ã‚¬ãƒ³ç‰å„ç¨®", a:"https://www.amazon.co.jp/s?k=%E3%82%AC%E3%83%B3%E7%8E%89&tag=YOURID-22",
                         r:"https://search.rakuten.co.jp/search/mall/%E3%82%AC%E3%83%B3%E7%8E%89/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ]
};

/* ===== é‡£ã‚Šå ´DBï¼ˆçœç•¥ï¼šæ±äº¬éƒ½ã¶ã‚“ï¼‰ ===== */
const DB = [
  {
    id:"wakasu",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è‹¥æ´²æµ·æµœå…¬åœ’ï¼ˆæµ·é‡£ã‚Šæ–½è¨­ãƒ»äººå·¥ç£¯ï¼‰",
    address:"æ±äº¬éƒ½æ±Ÿæ±åŒºè‹¥æ´²3ä¸ç›®",
    map:"https://maps.google.com/?q=%E8%8B%A5%E6%B4%B2%E6%B5%B7%E6%BF%B1%E5%85%AC%E5%9C%92%20%E6%B5%B7%E9%87%A3%E3%82%8A%E6%96%BD%E8%A8%AD",
    zones:[
      {type:"å ¤é˜²", fishes:["ã‚¢ã‚¸","ã‚¤ã‚·ãƒ¢ãƒ","ã‚³ãƒã‚·ãƒ­","ãƒ¡ãƒãƒ«","ã‚·ãƒ¼ãƒã‚¹"]},
      {type:"ãƒ†ãƒˆãƒ©/äººå·¥ç£¯", fishes:["ã‚«ã‚µã‚´","ãƒ¡ãƒãƒ«","ã‚·ãƒ¼ãƒã‚¹"]}
    ],
    methods:["ã‚µãƒ“ã‚­","ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­","ã¡ã‚‡ã„æŠ•ã’","ãƒ«ã‚¢ãƒ¼","ç©´é‡£ã‚Š","èƒ´çªã","ãƒ–ãƒ©ã‚¯ãƒª","ã‚¦ã‚­","ãƒ•ã‚«ã‚»","ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼","ã¶ã£ã“ã¿"],
    shelf:"å ¤é˜²è§’ã®æ˜æš—ï¼äººå·¥ç£¯ã®çŸ³é–“ï¼ˆç©´æ‰“ã¡ï¼‰ï¼è¡¨å±¤ã€œä¸­å±¤å›éŠ",
    times:"æœå¤•ãƒã‚ºãƒ¡ã¨ãƒŠã‚¤ãƒˆæœ‰åˆ©",
    rules:"å®‰å…¨æŸµã‚ã‚Šãƒ»æ··é›‘å¤šã‚ã€‚ãƒ©ã‚¤ãƒ•ã‚¸ãƒ£ã‚±ãƒƒãƒˆæ¨å¥¨ã€‚"
  },
  {
    id:"toyosu-gururi",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è±Šæ´²ãã‚‹ã‚Šå…¬åœ’ï¼ˆè­·å²¸ï¼‰",
    address:"æ±Ÿæ±åŒºè±Šæ´²6ä¸ç›®ã»ã‹",
    map:"https://maps.google.com/?q=%E8%B1%8A%E6%B4%B2%E3%81%90%E3%82%8B%E3%82%8A%E5%85%AC%E5%9C%92",
    zones:[ {type:"è­·å²¸", fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ãƒ¡ãƒãƒ«","ã‚«ã‚µã‚´","ã‚¯ãƒ­ãƒ€ã‚¤","ã‚µãƒ¨ãƒª"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­","ã¡ã‚‡ã„æŠ•ã’","ã¶ã£ã“ã¿","ãƒ•ã‚«ã‚»"],
    shelf:"æŸµéš›ã®ã‚­ãƒ¯ï¼æ©‹ãƒ»å¸¸å¤œç¯ã®æ˜æš—ï¼è¶³å…ƒã®ã‚«ã‚±ä¸ŠãŒã‚Š",
    times:"ãƒã‚¼ã¯æ—¥ä¸­ã€ã‚·ãƒ¼ãƒã‚¹ã¯å¤œã®æ˜æš—",
    rules:"æ’’ãé¤Œ/ãƒˆãƒªãƒƒã‚¯ã‚µãƒ“ã‚­/ãƒ­ã‚±ãƒƒãƒˆå¤©ç§¤ç¦æ­¢ã€‚æ­©è¡Œè€…æœ€å„ªå…ˆã€‚"
  },
  {
    id:"sunamachi-mizube",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"ç ‚ç”ºæ°´è¾ºå…¬åœ’ï¼ˆè’å·ãƒ»æ±Ÿæ±åŒºå´ï¼‰",
    address:"æ±ç ‚7ã€œ8ä¸ç›®",
    map:"https://maps.google.com/?q=%E7%A0%82%E7%94%BA%E6%B0%B4%E8%BE%BA%E5%85%AC%E5%9C%92",
    zones:[ {type:"è­·å²¸ï¼ˆã‚´ãƒ­ã‚¿ï¼‰", fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ã‚¯ãƒ­ãƒ€ã‚¤","ãƒœãƒ©"]} ],
    methods:["ã¡ã‚‡ã„æŠ•ã’","ã‚¦ã‚­","ãƒ«ã‚¢ãƒ¼","ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ã¶ã£ã“ã¿","ãƒ•ã‚«ã‚»"],
    shelf:"ã‚´ãƒ­ã‚¿ã®ã‚­ãƒ¯ã€œæ•°må…ˆï¼æ©‹è„šã®ãƒ¨ãƒ¬ï¼ä¸‹ã’å§‹ã‚",
    times:"ä¸‹ã’å§‹ã‚â—ï¼æœå¤•â—‹",
    rules:"è¶³å…ƒæ ¹æ›ã‹ã‚Šæ³¨æ„ã€‚ãƒˆã‚¤ãƒ¬ç‚¹åœ¨ã€‚"
  },
  {
    id:"kyunakagawa",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº/æ±Ÿæˆ¸å·åŒº",
    name:"æ—§ä¸­å·ï¼ˆæ±å¤§å³¶é§…ã€œä¸­å·å¤§æ©‹ï¼‰",
    address:"é§…ç›´ä¸‹ã€œä¸­å·å¤§æ©‹æ²¿ã„",
    map:"https://maps.google.com/?q=%E6%97%A7%E4%B8%AD%E5%B7%9D%20%E6%9D%B1%E5%A4%A7%E5%B3%B6",
    zones:[ {type:"æ²³å·ï¼ˆã‚´ãƒ­ã‚¿è­·å²¸/æ©‹è„šï¼‰", fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","ãƒ«ã‚¢ãƒ¼","ã¡ã‚‡ã„æŠ•ã’","ã¶ã£ã“ã¿"],
    shelf:"æ©‹ã®é™°ãƒ»ã‚´ãƒ­ã‚¿çŸ³é–“ï¼é§…ç›´ä¸‹ã€œå¤§æ©‹ãŒå®‰å®š",
    times:"ç››å¤ã€œåˆç§‹ã¯ãƒ‡ã‚¤å¼·ã„",
    rules:"é§è»Šã¯å¤§å³¶å°æ¾å·å…¬åœ’ãŒä¾¿åˆ©ã€‚"
  },
  {
    id:"arakawa-estuary",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è’å·æ²³å£ï¼ˆæ¸…ç ‚å¤§æ©‹ã€œæ–°ç ‚æ°´è¾ºå…¬åœ’ï¼‰",
    address:"æ¸…ç ‚å¤§æ©‹ã€œæ–°ç ‚æ°´è¾ºå…¬åœ’æ²¿ã„",
    map:"https://maps.google.com/?q=%E6%B8%85%E7%A0%82%E5%A4%A7%E6%A9%8B%20%E6%96%B0%E7%A0%82%E6%B0%B4%E8%BE%BA%E5%85%AC%E5%9C%92",
    zones:[ {type:"æ²³å£ï¼ˆã‚´ãƒ­ã‚¿ï¼‰", fishes:["ã‚·ãƒ¼ãƒã‚¹","ã‚¯ãƒ­ãƒ€ã‚¤","ãƒã‚¼"]} ],
    methods:["ãƒ«ã‚¢ãƒ¼","ã¶ã£ã“ã¿","ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ã‚¦ã‚­","ãƒ•ã‚«ã‚»"],
    shelf:"ã‚´ãƒ­ã‚¿ã®éš›ï¼ãƒ¨ãƒ¬ï¼æ½®ã®å‹•ãå‡ºã—",
    times:"æ½®ãŒå‹•ãã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼æœå¤•â—",
    rules:"è¶³å…ƒæ»‘ã‚Šæ³¨æ„ã€‚æœ€å¯„ã‚Šãƒˆã‚¤ãƒ¬ã¯æ–°ç ‚æ°´è¾ºå…¬åœ’ã€‚"
  },
  {
    id:"hirai-undo",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæˆ¸å·åŒº",
    name:"å¹³äº•é‹å‹•å…¬åœ’ï¼ˆè’å·Ã—æ—§ä¸­å·åˆæµåŸŸï¼‰",
    address:"æ±Ÿæˆ¸å·åŒºå¹³äº• è’å·ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å†…",
    map:"https://maps.google.com/?q=%E5%B9%B3%E4%BA%95%E9%81%8B%E5%8B%95%E5%85%AC%E5%9C%92%20%E8%8D%92%E5%B7%9D",
    zones:[ {type:"æ²³å·è­·å²¸/æ©‹è„š", fishes:["ã‚·ãƒ¼ãƒã‚¹","ãƒã‚¼","ã‚³ã‚¤","ã‚¦ãƒŠã‚®"]} ],
    methods:["ãƒ«ã‚¢ãƒ¼","ã¶ã£ã“ã¿","ã‚¦ã‚­","ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã¡ã‚‡ã„æŠ•ã’"],
    shelf:"æ©‹è„šæ˜æš—ï¼æ’æ°´æ©Ÿå ´ã®åè»¢æµï¼é§†ã‘ä¸ŠãŒã‚Š",
    times:"å¤œæ˜ã‘å‰å¾Œãƒ»å¤•ã¾ãšã‚",
    rules:"æ²³å·æ•·é§è»Šå ´ã¯åœŸæ—¥ç¥ã®ã¿é–‹æ”¾ã€‚"
  },
  {
    id:"tamagawa-daishi",
    pref:"æ±äº¬éƒ½", city:"å¤§ç”°åŒº",
    name:"å¤šæ‘©å·ãƒ»å¤§å¸«æ©‹ã€œç¾½ç”°ï¼ˆæ±äº¬éƒ½å´ï¼‰",
    address:"å¤§å¸«æ©‹å‘¨è¾ºã€œç¾½ç”°ç©ºæ¸¯å¯„ã‚Šæ²³å£",
    map:"https://maps.google.com/?q=%E5%A4%9A%E6%91%A9%E5%B7%9D%20%E5%A4%A7%E5%B8%AB%E6%A9%8B",
    zones:[ {type:"æ²³å£/è­·å²¸", fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´","ãƒã‚´ãƒ"]} ],
    methods:["ã¡ã‚‡ã„æŠ•ã’","ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­","ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼","ã¶ã£ã“ã¿"],
    shelf:"æ©‹è„šãƒ¨ãƒ¬ï¼æ½®ä½å¤‰åŒ–ã§å‹•ãã‚«ã‚±ä¸ŠãŒã‚Š",
    times:"ä¸‹ã’ã®å‹•ãå‡ºã—ï¼æœå¤•",
    rules:"æ¿ã‚Šå¾Œã«å¥½èª¿ãªæ—¥ã‚ã‚Šã€‚"
  },
  {
    id:"ooi-nagisa",
    pref:"æ±äº¬éƒ½", city:"å“å·åŒº/å¤§ç”°åŒº",
    name:"å¤§äº•ãµé ­ä¸­å¤®æµ·æµœå…¬åœ’ï¼ˆãªãã•ã®æ£®ï¼‰",
    address:"å“å·åŒºå…«æ½®4-2-1 å‘¨è¾º",
    map:"https://maps.google.com/?q=%E5%A4%A7%E4%BA%95%E3%81%B5%E9%A0%AD%E4%B8%AD%E5%A4%AE%E6%B5%B7%E6%B5%9C%E5%85%AC%E5%9C%92%20%E3%81%AA%E3%81%8E%E3%81%95%E3%81%AE%E6%A3%AE",
    zones:[ {type:"ç£¯çŠ¶è­·å²¸", fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","ãƒ«ã‚¢ãƒ¼","ã¡ã‚‡ã„æŠ•ã’"],
    shelf:"ã‚´ãƒ­ã‚¿ã®ç©´ãƒ»å²©é™°ã®è¶…è¿‘è·é›¢",
    times:"ãƒ‡ã‚¤ã§OKï¼ˆãƒ•ã‚¡ãƒŸãƒªãƒ¼â—ï¼‰",
    rules:"ç«‹å…¥ãƒ»é‡£ã‚Šç¦æ­¢åŒºç”»ã‚ã‚Šï¼å±é™ºãªæŠ•ã’é‡£ã‚Šç¦æ­¢ã€‚"
  },
  {
    id:"yokojikken",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"æ¨ªåé–“å·è¦ªæ°´å…¬åœ’ï¼ˆé‹æ²³ï¼‰",
    address:"å¤§å³¶ãƒ»åŒ—ç ‚å‘¨è¾º",
    map:"https://maps.google.com/?q=%E6%A8%AA%E5%8D%81%E9%96%93%E5%B7%9D%E8%A6%AA%E6%B0%B4%E5%85%AC%E5%9C%92",
    zones:[ {type:"é‹æ²³", fishes:["ãƒã‚¼","ãƒ†ãƒŠã‚¬ã‚¨ãƒ“"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","å°ã‚¦ã‚­","ã‚¦ã‚­"],
    shelf:"è¶³å…ƒéš›ãƒ»æ©‹å‘¨ã‚Šã®é™°",
    times:"å¤ã€œåˆç§‹ã®ãƒ‡ã‚¤/å¤•æ–¹â—",
    rules:"ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘ã€‚"
  },
  {
    id:"mizumoto",
    pref:"æ±äº¬éƒ½", city:"è‘›é£¾åŒº",
    name:"æ°´å…ƒå…¬åœ’ï¼ˆæ·¡æ°´ï¼šæ± ãƒ»æ°´è·¯ï¼‰",
    address:"è‘›é£¾åŒº æ°´å…ƒå…¬åœ’",
    map:"https://maps.google.com/?q=%E6%B0%B4%E5%85%83%E5%85%AC%E5%9C%92",
    zones:[ {type:"æ± ãƒ»æ°´è·¯", fishes:["ã‚³ã‚¤","ãƒ•ãƒŠ","ãƒ˜ãƒ©ãƒ–ãƒŠ","ãƒ†ãƒŠã‚¬ã‚¨ãƒ“"]} ],
    methods:["ã‚¦ã‚­ï¼ˆã‚¨ã‚µé‡£ã‚Šï¼‰","ãƒŸãƒ£ã‚¯é‡£ã‚Š"],
    shelf:"æ°´è·¯ãƒ»ãƒ¯ãƒ³ãƒ‰ã®ã‚«ã‚±ä¸ŠãŒã‚Šï¼æ­ã¾ã‚ã‚Š",
    times:"æ—¥ä¸­ã§OKï¼ˆæ··é›‘æ³¨æ„ï¼‰",
    rules:"ç„¡æ–™ï¼ˆä¸€éƒ¨æ–½è¨­é™¤ãï¼‰ã€‚é§è»Šå ´ãƒ»ãƒˆã‚¤ãƒ¬å¤šæ•°ã€‚"
  }
];

/* éƒ½é“åºœçœŒä¸€è¦§ */
const PREFS = [...new Set(DB.map(p=>p.pref))];

/* ===== çŠ¶æ…‹ ===== */
const state = { step:0, pref:null, placeId:null, zoneIdx:null, fish:null, method:null };
const stepsTitle = ["éƒ½é“åºœçœŒ","é‡£ã‚Šå ´","ãƒã‚¤ãƒ³ãƒˆç¨®åˆ¥","é­šç¨®","é‡£ã‚Šæ–¹","çµæœ"];

function setSteps(){
  const s = document.getElementById('steps');
  s.innerHTML = stepsTitle.map((t,i)=>`<div class="step ${i<=state.step?'on':''}">${i+1}. ${t}</div>`).join('');
  document.getElementById('back').hidden = state.step===0;
}

/* ===== æç”» ===== */
function render(){
  setSteps();
  const app = document.getElementById('app');

  // 0: éƒ½é“åºœçœŒ
  if(state.step===0){
    app.innerHTML = `<div class="hero"><strong>éƒ½é“åºœçœŒ</strong> ã‚’é¸ã¶ã¨ã€ãã®åœ°åŸŸã®é‡£ã‚Šå ´ãŒå‡ºã¾ã™ã€‚</div>
    <div class="grid">
      ${PREFS.map(p=>{
        const n = DB.filter(d=>d.pref===p).length;
        return `<div class="card">
          <h3>${p}</h3>
          <p class="muted">${n} ã‚¹ãƒãƒƒãƒˆ</p>
          <div class="row"><button class="pri" onclick="selPref('${p}')">ã“ã®éƒ½é“åºœçœŒã‚’é¸ã¶</button></div>
        </div>`}).join('')}
    </div>`;
    return;
  }

  // 1: é‡£ã‚Šå ´
  if(state.step===1){
    const list = DB.filter(d=>d.pref===state.pref);
    app.innerHTML = `<div class="grid">
      ${list.map(d=>`
        <div class="c<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RigNavi MVP</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  :root{
    /* æ˜ã‚‹ã‚ï¼†ä»Šã£ã½ã„æµ·é…è‰² */
    --bg1:#eff9ff; --bg2:#e9f5ff;
    --ink:#0b2531; --muted:#5a7b8c;
    --glass:#ffffffc9; --line:#d8e9f3;
    --card:#ffffff; --chip:#f4faff;
    --accent:#12b6ff; --accent-ink:#013449;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--ink);
    font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
  }
  header{
    position:sticky; top:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px; backdrop-filter:saturate(140%) blur(10px);
    background:var(--glass); border-bottom:1px solid var(--line);
  }
  .brand{font-weight:800; letter-spacing:.1px; display:flex; gap:8px; align-items:center}
  .brand i{font-style:normal; font-size:18px}
  .badge{background:#d6f4ff; color:#067; padding:6px 10px; border-radius:999px; font-size:12px}
  main{max-width:980px; margin:0 auto; padding:16px}
  #hello{margin:4px 0 16px; color:var(--muted)}
  .steps{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
  .step{border:1px solid var(--line); background:var(--chip); color:var(--muted);
        border-radius:12px; padding:8px 12px; font-size:13px}
  .step.on{border-color:#bfe9ff; color:#0a4c63; background:#e8f8ff; font-weight:700}
  #back{appearance:none; border:1px solid var(--line); background:#fff; color:var(--ink);
        padding:10px 14px; border-radius:10px}
  #back[hidden]{display:none}

  .grid{display:grid; gap:12px; grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
  .card{
    background:var(--card); border:1px solid var(--line); border-radius:16px;
    padding:16px; box-shadow:0 10px 22px rgba(23,70,96,.08);
  }
  h1,h2,h3{margin:.2em 0 .5em}
  h1{font-size:26px} h3{font-size:18px}
  .muted{color:var(--muted)}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .chips{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
  .chip,button{appearance:none; border:none; cursor:pointer; border-radius:12px; padding:12px 14px; font-size:15px}
  .chip{background:var(--chip)}
  button.pri{background:var(--accent); color:var(--accent-ink); font-weight:800}
  button.ghost{background:#fff; border:1px solid var(--line)}
  a{color:#007fb3}
  ul.items{padding-left:18px; margin:8px 0}
  ul.items li{margin:10px 0}
  .kv{display:flex; gap:10px; flex-wrap:wrap; margin:.6rem 0}
  .kv span{background:#f6fbff; border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:12px}
  .hero{background:linear-gradient(135deg,#e8f7ff,#ffffff); border:1px dashed var(--line); border-radius:16px; padding:12px; margin-bottom:12px}
  .banner{width:100%; border-radius:14px; border:1px solid var(--line); display:block}
  .shops{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
  .shop{padding:8px 10px; border-radius:10px; background:#fff; border:1px solid var(--line); font-size:14px}
  .cap{font-size:13px; color:var(--muted); margin:4px 0 8px}
  .sectionTitle{margin-top:12px; margin-bottom:6px; font-weight:800}
</style>
</head>
<body>
<header>
  <div class="brand"><i>ğŸ£</i>RigNavi</div>
  <div class="badge">MVP</div>
</header>

<main>
  <div id="hello">èµ·å‹•ä¸­â€¦</div>

  <div class="row" style="justify-content:space-between">
    <div class="steps" id="steps"></div>
    <button id="back" class="ghost" hidden onclick="goBack()">æˆ»ã‚‹</button>
  </div>

  <div id="app"></div>
</main>

<script>
/* ===== åŸºæœ¬è¨­å®š ===== */
const LIFF_ID = "2008257307-RwPLYWG1";
const VERSION = "9";

/* ===== é­šç¨®â†’è¨±å¯é‡£æ³•ï¼ˆè‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ ===== */
const FISH_METHODS = {
  "ã‚¢ã‚¸":      ["ã‚µãƒ“ã‚­","ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­","ã¡ã‚‡ã„æŠ•ã’","ã‚¦ã‚­"],     // ç©´é‡£ã‚Š/ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ã¯éè¡¨ç¤º
  "ã‚«ã‚µã‚´":    ["ç©´é‡£ã‚Š","èƒ´çªã","ãƒ–ãƒ©ã‚¯ãƒª","ã‚¦ã‚­"],               // ãƒ«ã‚¢ãƒ¼ã¯éæ¨å¥¨ãªã®ã§å¤–ã™
  "ãƒ¡ãƒãƒ«":    ["ã‚¦ã‚­","èƒ´çªã","ãƒ«ã‚¢ãƒ¼(è»½é‡)"],
  "ã‚·ãƒ¼ãƒã‚¹":  ["ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­"],                                   // ä¸»è»¸ã¯ãƒ«ã‚¢ãƒ¼
  "ã‚¤ã‚·ãƒ¢ãƒ":  ["ã¡ã‚‡ã„æŠ•ã’","èƒ´çªã"],
  "ã‚³ãƒã‚·ãƒ­":  ["ã‚µãƒ“ã‚­","ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­"],
  "ãƒã‚¼":      ["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","ã¡ã‚‡ã„æŠ•ã’"],
  "ã‚¯ãƒ­ãƒ€ã‚¤":  ["ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ã¶ã£ã“ã¿","ãƒ•ã‚«ã‚»"],
  "ãƒ†ãƒŠã‚¬ã‚¨ãƒ“":["ãƒŸãƒ£ã‚¯é‡£ã‚Š","å°ã‚¦ã‚­"],
  "ãƒ˜ãƒ©ãƒ–ãƒŠ":  ["ã‚¦ã‚­ï¼ˆã‚¨ã‚µé‡£ã‚Šï¼‰"],
  "ãƒã‚´ãƒ":    ["ãƒ«ã‚¢ãƒ¼","ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼"],                          // ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼æƒ³å®š
  "ã‚»ã‚¤ã‚´":    ["ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­"]
};

/* ===== é­šç”»åƒï¼ˆä»®ï¼‰ ===== */
const FISH_IMAGES = {
  "ã‚¢ã‚¸":"https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?q=80&w=1200&auto=format&fit=crop",
  "ã‚«ã‚µã‚´":"https://images.unsplash.com/photo-1558981359-219d6364c9cc?q=80&w=1200&auto=format&fit=crop",
  "ãƒ¡ãƒãƒ«":"https://images.unsplash.com/photo-1524704654690-b56c05c78a00?q=80&w=1200&auto=format&fit=crop",
  "ã‚·ãƒ¼ãƒã‚¹":"https://images.unsplash.com/photo-1526481280698-8fcc13fd3b5d?q=80&w=1200&auto=format&fit=crop",
  "ãƒã‚¼":"https://images.unsplash.com/photo-1544551763-7ef25f88c5f5?q=80&w=1200&auto=format&fit=crop",
  "ã‚¯ãƒ­ãƒ€ã‚¤":"https://images.unsplash.com/photo-1546868871-7041f2a55e12?q=80&w=1200&auto=format&fit=crop",
  "ãƒ†ãƒŠã‚¬ã‚¨ãƒ“":"https://images.unsplash.com/photo-1504707748692-419802cf939d?q=80&w=1200&auto=format&fit=crop",
  "ãƒ˜ãƒ©ãƒ–ãƒŠ":"https://images.unsplash.com/photo-1464925257126-6450e871c667?q=80&w=1200&auto=format&fit=crop",
  "ãƒã‚´ãƒ":"https://images.unsplash.com/photo-1461354464878-ad92f492a5a0?q=80&w=1200&auto=format&fit=crop",
  "ã‚¤ã‚·ãƒ¢ãƒ":"https://images.unsplash.com/photo-1498654200943-1088dd4438ae?q=80&w=1200&auto=format&fit=crop",
  "ã‚³ãƒã‚·ãƒ­":"https://images.unsplash.com/photo-1534088568595-a066f410bcda?q=80&w=1200&auto=format&fit=crop",
  "ã‚»ã‚¤ã‚´":"https://images.unsplash.com/photo-1531959870249-9d3f62f96f22?q=80&w=1200&auto=format&fit=crop"
};
/* ä»»æ„ï¼šimg/fish-xxx.png ã‚’ç½®ã‘ã°è‡ªå‹•ã§ãã¡ã‚‰ã‚’å„ªå…ˆè¡¨ç¤º */
function fishImg(f){ const local=`img/fish-${toSlug(f)}.png`; return localExistsHint(local) || FISH_IMAGES[f] || null; }

/* ===== ä»•æ›ã‘ã‚¤ãƒ©ã‚¹ãƒˆï¼ˆä»®ï¼‰ =====
   1) img/rig-<fish>-<method>.png ãŒã‚ã‚Œã°ãã‚Œã‚’
   2) ãªã‘ã‚Œã° method ã®æ±ç”¨
   3) ãã‚Œã‚‚ç„¡ã‘ã‚Œã°ãƒ€ãƒŸãƒ¼ç”»åƒ */
const RIG_DEFAULT_BY_METHOD = {
  "ã‚µãƒ“ã‚­":"https://placehold.co/1200x600?text=Sabiki+Rig+Guide",
  "ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­":"https://placehold.co/1200x600?text=Rocket+Sabiki+Rig",
  "ã¡ã‚‡ã„æŠ•ã’":"https://placehold.co/1200x600?text=Light+Surf+Rig",
  "èƒ´çªã":"https://placehold.co/1200x600?text=Dropper+Loop+Rig",
  "ãƒ–ãƒ©ã‚¯ãƒª":"https://placehold.co/1200x600?text=Burakuri+Rig",
  "ã‚¦ã‚­":"https://placehold.co/1200x600?text=Float+Rig",
  "ãƒŸãƒ£ã‚¯é‡£ã‚Š":"https://placehold.co/1200x600?text=Keiryu/Miyakuzuri",
  "ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿":"https://placehold.co/1200x600?text=Heci+Otoshikomi",
  "ãƒ«ã‚¢ãƒ¼":"https://placehold.co/1200x600?text=Lure+Setup",
  "ãƒ«ã‚¢ãƒ¼(è»½é‡)":"https://placehold.co/1200x600?text=Light+Game+Setup",
  "ã¶ã£ã“ã¿":"https://placehold.co/1200x600?text=Bottom+Rig",
  "ãƒ•ã‚«ã‚»":"https://placehold.co/1200x600?text=Float+Drift+(Fukase)",
  "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼":"https://placehold.co/1200x600?text=Elevator+Rig",
  "å°ã‚¦ã‚­":"https://placehold.co/1200x600?text=Small+Float+Rig",
  "ã‚¦ã‚­ï¼ˆã‚¨ã‚µé‡£ã‚Šï¼‰":"https://placehold.co/1200x600?text=Float+Bait"
};
function rigImg(fish,method){
  const m = method || "";
  const localSpecific = `img/rig-${toSlug(fish)}-${toSlug(m)}.png`;
  const localGeneric  = `img/rig-${toSlug(m)}.png`;
  return localExistsHint(localSpecific) || localExistsHint(localGeneric) || RIG_DEFAULT_BY_METHOD[m] || "https://placehold.co/1200x600?text=Rig+Illustration";
}
/* è£œåŠ©ï¼šå®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨åˆ¤å®šã¯å‡ºæ¥ãªã„ã®ã§ã€å¸¸ã«ãƒ‘ã‚¹ã‚’è¿”ã— onerror ã§éè¡¨ç¤ºå‡¦ç† */
function localExistsHint(path){ return path; }

/* ===== é­šç¨®â†’ã‚®ã‚¢ï¼ˆAmazon/Rakutenï¼‰ ===== */
const LINKS_BY_FISH = {
  "ã‚¢ã‚¸":[
    {label:"ãƒˆãƒªãƒƒã‚¯ã‚µãƒ“ã‚­ #6ã€œ8", a:"https://www.amazon.co.jp/s?k=%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF+%E3%82%B5%E3%83%93%E3%82%AD&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%88%E3%83%AA%E3%83%83%E3%82%AF+%E3%82%B5%E3%83%93%E3%82%AD/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ã‚¢ãƒŸã‚³ãƒã‚»ï¼ˆãƒ‘ãƒƒã‚¯ï¼‰",   a:"https://www.amazon.co.jp/s?k=%E3%82%A2%E3%83%9F+%E3%82%B3%E3%83%9E%E3%82%BB&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%82%A2%E3%83%9F+%E3%82%B3%E3%83%9E%E3%82%BB/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚«ã‚µã‚´":[
    {label:"ãƒ–ãƒ©ã‚¯ãƒª 5ã€œ8å·",       a:"https://www.amazon.co.jp/s?k=%E3%83%96%E3%83%A9%E3%82%AF%E3%83%AA&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%96%E3%83%A9%E3%82%AF%E3%83%AA/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"æ ¹é­šãƒ¯ãƒ¼ãƒ  2inch",      a:"https://www.amazon.co.jp/s?k=%E6%A0%B9%E9%AD%9A+%E3%83%AF%E3%83%BC%E3%83%A0&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E6%A0%B9%E9%AD%9A+%E3%83%AF%E3%83%BC%E3%83%A0/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚·ãƒ¼ãƒã‚¹":[
    {label:"ãƒŸãƒãƒ¼ 9ã€œ12cm",        a:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%9F%E3%83%8E%E3%83%BC&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%9F%E3%83%8E%E3%83%BC/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ãƒã‚¤ãƒ– 14ã€œ20g",        a:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%90%E3%82%A4%E3%83%96&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%90%E3%82%A4%E3%83%96/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒã‚¼":[
    {label:"ã®ã¹ç«¿2.7mï¼‹å°éˆ",      a:"https://www.amazon.co.jp/s?k=%E3%81%AE%E3%81%B9%E7%AB%BF+2.7m&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%81%AE%E3%81%B9%E7%AB%BF+2.7m/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ãƒŸãƒ£ã‚¯é‡£ã‚Šä»•æ›ã‘",      a:"https://www.amazon.co.jp/s?k=%E3%83%8F%E3%82%BC+%E3%83%9F%E3%83%A3%E3%82%AF%E9%87%A3%E3%82%8A&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%8F%E3%82%BC+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚¯ãƒ­ãƒ€ã‚¤":[
    {label:"è½ã¨ã—è¾¼ã¿ä¸€å¼",        a:"https://www.amazon.co.jp/s?k=%E8%90%BD%E3%81%A8%E3%81%97%E8%BE%BC%E3%81%BF+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E8%90%BD%E3%81%A8%E3%81%97%E8%BE%BC%E3%81%BF+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ†ãƒŠã‚¬ã‚¨ãƒ“":[
    {label:"ãƒ†ãƒŠã‚¬ã‚¨ãƒ“ä»•æ›ã‘",      a:"https://www.amazon.co.jp/s?k=%E3%83%86%E3%83%8A%E3%82%AC%E3%82%A8%E3%83%93+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%86%E3%83%8A%E3%82%AC%E3%82%A8%E3%83%93+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ˜ãƒ©ãƒ–ãƒŠ":[
    {label:"ã‚¦ã‚­ä»•æ›ã‘",            a:"https://www.amazon.co.jp/s?k=%E3%83%98%E3%83%A9%E3%83%96%E3%83%8A+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                     r:"https://search.rakuten.co.jp/search/mall/%E3%83%98%E3%83%A9%E3%83%96%E3%83%8A+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒã‚´ãƒ":[
    {label:"ã‚¸ã‚°ãƒ˜ãƒƒãƒ‰20ã€œ30gï¼‹ãƒ¯ãƒ¼ãƒ ", a:"https://www.amazon.co.jp/s?k=%E3%83%9E%E3%82%B4%E3%83%81+%E3%83%AF%E3%83%BC%E3%83%A0&tag=YOURID-22",
                                         r:"https://search.rakuten.co.jp/search/mall/%E3%83%9E%E3%82%B4%E3%83%81+%E3%83%AF%E3%83%BC%E3%83%A0/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ]
};

/* ===== é‡£ã‚Šæ–¹â†’é¤Œ/æ’’ãé¤ŒãŠã™ã™ã‚ ===== */
const BAIT_BY_METHOD = {
  "ã‚µãƒ“ã‚­":[
    {label:"ã‚¢ãƒŸå§«ï¼ˆå¸¸æ¸©ï¼‰", a:"https://www.amazon.co.jp/s?k=%E3%82%A2%E3%83%9F%E5%A7%AB&tag=YOURID-22",
                               r:"https://search.rakuten.co.jp/search/mall/%E3%82%A2%E3%83%9F%E5%A7%AB/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ã‚³ãƒã‚»ã‚¹ãƒ—ãƒ¼ãƒ³", a:"https://www.amazon.co.jp/s?k=%E3%82%B3%E3%83%9E%E3%82%BB+%E3%82%B9%E3%83%97%E3%83%BC%E3%83%B3&tag=YOURID-22",
                               r:"https://search.rakuten.co.jp/search/mall/%E3%82%B3%E3%83%9E%E3%82%BB+%E3%82%B9%E3%83%97%E3%83%BC%E3%83%B3/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­":[
    {label:"ãƒ­ã‚±ãƒƒãƒˆã‚«ã‚´å¤©ç§¤", a:"https://www.amazon.co.jp/s?k=%E3%83%AD%E3%82%B1%E3%83%83%E3%83%88+%E3%82%AB%E3%82%B4&tag=YOURID-22",
                                 r:"https://search.rakuten.co.jp/search/mall/%E3%83%AD%E3%82%B1%E3%83%83%E3%83%88+%E3%82%AB%E3%82%B4/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒ•ã‚«ã‚»":[
    {label:"ã‚ªã‚­ã‚¢ãƒŸç”Ÿ/ãƒœã‚¤ãƒ«", a:"https://www.amazon.co.jp/s?k=%E3%82%AA%E3%82%AD%E3%82%A2%E3%83%9F&tag=YOURID-22",
                                 r:"https://search.rakuten.co.jp/search/mall/%E3%82%AA%E3%82%AD%E3%82%A2%E3%83%9F/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"é…åˆã‚¨ã‚µï¼ˆã‚°ãƒ¬ç”¨ç­‰ï¼‰", a:"https://www.amazon.co.jp/s?k=%E3%83%95%E3%82%AB%E3%82%BB+%E9%85%8D%E5%90%88&tag=YOURID-22",
                                   r:"https://search.rakuten.co.jp/search/mall/%E3%83%95%E3%82%AB%E3%82%BB+%E9%85%8D%E5%90%88/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼":[
    {label:"æ´»é¤Œï¼ˆã‚¢ã‚¸ç­‰ï¼‰æ´»ã‹ã—ãƒã‚±ãƒ„", a:"https://www.amazon.co.jp/s?k=%E6%B4%BB%E3%81%8B%E3%81%97%E3%83%90%E3%82%B1%E3%83%84&tag=YOURID-22",
                                           r:"https://search.rakuten.co.jp/search/mall/%E6%B4%BB%E3%81%8B%E3%81%97%E3%83%90%E3%82%B1%E3%83%84/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"},
    {label:"ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ä»•æ›ã‘", a:"https://www.amazon.co.jp/s?k=%E3%82%A8%E3%83%AC%E3%83%99%E3%83%BC%E3%82%BF%E3%83%BC+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22",
                                 r:"https://search.rakuten.co.jp/search/mall/%E3%82%A8%E3%83%AC%E3%83%99%E3%83%BC%E3%82%BF%E3%83%BC+%E4%BB%95%E6%8E%9B%E3%81%91/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "èƒ´çªã":[
    {label:"é’ã‚¤ã‚½ãƒ¡", a:"https://www.amazon.co.jp/s?k=%E9%9D%92%E3%82%A4%E3%82%BD%E3%83%A1&tag=YOURID-22",
                       r:"https://search.rakuten.co.jp/search/mall/%E9%9D%92%E3%82%A4%E3%82%BD%E3%83%A1/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ã¶ã£ã“ã¿":[
    {label:"å¤œå…‰éˆ´/ãƒ™ãƒ«", a:"https://www.amazon.co.jp/s?k=%E5%A4%9C%E5%85%89%E9%88%B4+%E9%87%A3%E3%82%8A&tag=YOURID-22",
                         r:"https://search.rakuten.co.jp/search/mall/%E5%A4%9C%E5%85%89%E9%88%B4+%E9%87%A3%E3%82%8A/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ],
  "ãƒŸãƒ£ã‚¯é‡£ã‚Š":[
    {label:"ã‚¬ãƒ³ç‰å„ç¨®", a:"https://www.amazon.co.jp/s?k=%E3%82%AC%E3%83%B3%E7%8E%89&tag=YOURID-22",
                         r:"https://search.rakuten.co.jp/search/mall/%E3%82%AC%E3%83%B3%E7%8E%89/?scid=af_pc_etc&icm_cid=YOUR_RAKUTEN_ID"}
  ]
};

/* ===== é‡£ã‚Šå ´DBï¼ˆçœç•¥ï¼šæ±äº¬éƒ½ã¶ã‚“ï¼‰ ===== */
const DB = [
  {
    id:"wakasu",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è‹¥æ´²æµ·æµœå…¬åœ’ï¼ˆæµ·é‡£ã‚Šæ–½è¨­ãƒ»äººå·¥ç£¯ï¼‰",
    address:"æ±äº¬éƒ½æ±Ÿæ±åŒºè‹¥æ´²3ä¸ç›®",
    map:"https://maps.google.com/?q=%E8%8B%A5%E6%B4%B2%E6%B5%B7%E6%BF%B1%E5%85%AC%E5%9C%92%20%E6%B5%B7%E9%87%A3%E3%82%8A%E6%96%BD%E8%A8%AD",
    zones:[
      {type:"å ¤é˜²", fishes:["ã‚¢ã‚¸","ã‚¤ã‚·ãƒ¢ãƒ","ã‚³ãƒã‚·ãƒ­","ãƒ¡ãƒãƒ«","ã‚·ãƒ¼ãƒã‚¹"]},
      {type:"ãƒ†ãƒˆãƒ©/äººå·¥ç£¯", fishes:["ã‚«ã‚µã‚´","ãƒ¡ãƒãƒ«","ã‚·ãƒ¼ãƒã‚¹"]}
    ],
    methods:["ã‚µãƒ“ã‚­","ãƒ­ã‚±ãƒƒãƒˆã‚µãƒ“ã‚­","ã¡ã‚‡ã„æŠ•ã’","ãƒ«ã‚¢ãƒ¼","ç©´é‡£ã‚Š","èƒ´çªã","ãƒ–ãƒ©ã‚¯ãƒª","ã‚¦ã‚­","ãƒ•ã‚«ã‚»","ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼","ã¶ã£ã“ã¿"],
    shelf:"å ¤é˜²è§’ã®æ˜æš—ï¼äººå·¥ç£¯ã®çŸ³é–“ï¼ˆç©´æ‰“ã¡ï¼‰ï¼è¡¨å±¤ã€œä¸­å±¤å›éŠ",
    times:"æœå¤•ãƒã‚ºãƒ¡ã¨ãƒŠã‚¤ãƒˆæœ‰åˆ©",
    rules:"å®‰å…¨æŸµã‚ã‚Šãƒ»æ··é›‘å¤šã‚ã€‚ãƒ©ã‚¤ãƒ•ã‚¸ãƒ£ã‚±ãƒƒãƒˆæ¨å¥¨ã€‚"
  },
  {
    id:"toyosu-gururi",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è±Šæ´²ãã‚‹ã‚Šå…¬åœ’ï¼ˆè­·å²¸ï¼‰",
    address:"æ±Ÿæ±åŒºè±Šæ´²6ä¸ç›®ã»ã‹",
    map:"https://maps.google.com/?q=%E8%B1%8A%E6%B4%B2%E3%81%90%E3%82%8B%E3%82%8A%E5%85%AC%E5%9C%92",
    zones:[ {type:"è­·å²¸", fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ãƒ¡ãƒãƒ«","ã‚«ã‚µã‚´","ã‚¯ãƒ­ãƒ€ã‚¤","ã‚µãƒ¨ãƒª"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­","ã¡ã‚‡ã„æŠ•ã’","ã¶ã£ã“ã¿","ãƒ•ã‚«ã‚»"],
    shelf:"æŸµéš›ã®ã‚­ãƒ¯ï¼æ©‹ãƒ»å¸¸å¤œç¯ã®æ˜æš—ï¼è¶³å…ƒã®ã‚«ã‚±ä¸ŠãŒã‚Š",
    times:"ãƒã‚¼ã¯æ—¥ä¸­ã€ã‚·ãƒ¼ãƒã‚¹ã¯å¤œã®æ˜æš—",
    rules:"æ’’ãé¤Œ/ãƒˆãƒªãƒƒã‚¯ã‚µãƒ“ã‚­/ãƒ­ã‚±ãƒƒãƒˆå¤©ç§¤ç¦æ­¢ã€‚æ­©è¡Œè€…æœ€å„ªå…ˆã€‚"
  },
  {
    id:"sunamachi-mizube",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"ç ‚ç”ºæ°´è¾ºå…¬åœ’ï¼ˆè’å·ãƒ»æ±Ÿæ±åŒºå´ï¼‰",
    address:"æ±ç ‚7ã€œ8ä¸ç›®",
    map:"https://maps.google.com/?q=%E7%A0%82%E7%94%BA%E6%B0%B4%E8%BE%BA%E5%85%AC%E5%9C%92",
    zones:[ {type:"è­·å²¸ï¼ˆã‚´ãƒ­ã‚¿ï¼‰", fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ã‚¯ãƒ­ãƒ€ã‚¤","ãƒœãƒ©"]} ],
    methods:["ã¡ã‚‡ã„æŠ•ã’","ã‚¦ã‚­","ãƒ«ã‚¢ãƒ¼","ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ã¶ã£ã“ã¿","ãƒ•ã‚«ã‚»"],
    shelf:"ã‚´ãƒ­ã‚¿ã®ã‚­ãƒ¯ã€œæ•°må…ˆï¼æ©‹è„šã®ãƒ¨ãƒ¬ï¼ä¸‹ã’å§‹ã‚",
    times:"ä¸‹ã’å§‹ã‚â—ï¼æœå¤•â—‹",
    rules:"è¶³å…ƒæ ¹æ›ã‹ã‚Šæ³¨æ„ã€‚ãƒˆã‚¤ãƒ¬ç‚¹åœ¨ã€‚"
  },
  {
    id:"kyunakagawa",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº/æ±Ÿæˆ¸å·åŒº",
    name:"æ—§ä¸­å·ï¼ˆæ±å¤§å³¶é§…ã€œä¸­å·å¤§æ©‹ï¼‰",
    address:"é§…ç›´ä¸‹ã€œä¸­å·å¤§æ©‹æ²¿ã„",
    map:"https://maps.google.com/?q=%E6%97%A7%E4%B8%AD%E5%B7%9D%20%E6%9D%B1%E5%A4%A7%E5%B3%B6",
    zones:[ {type:"æ²³å·ï¼ˆã‚´ãƒ­ã‚¿è­·å²¸/æ©‹è„šï¼‰", fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","ãƒ«ã‚¢ãƒ¼","ã¡ã‚‡ã„æŠ•ã’","ã¶ã£ã“ã¿"],
    shelf:"æ©‹ã®é™°ãƒ»ã‚´ãƒ­ã‚¿çŸ³é–“ï¼é§…ç›´ä¸‹ã€œå¤§æ©‹ãŒå®‰å®š",
    times:"ç››å¤ã€œåˆç§‹ã¯ãƒ‡ã‚¤å¼·ã„",
    rules:"é§è»Šã¯å¤§å³¶å°æ¾å·å…¬åœ’ãŒä¾¿åˆ©ã€‚"
  },
  {
    id:"arakawa-estuary",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è’å·æ²³å£ï¼ˆæ¸…ç ‚å¤§æ©‹ã€œæ–°ç ‚æ°´è¾ºå…¬åœ’ï¼‰",
    address:"æ¸…ç ‚å¤§æ©‹ã€œæ–°ç ‚æ°´è¾ºå…¬åœ’æ²¿ã„",
    map:"https://maps.google.com/?q=%E6%B8%85%E7%A0%82%E5%A4%A7%E6%A9%8B%20%E6%96%B0%E7%A0%82%E6%B0%B4%E8%BE%BA%E5%85%AC%E5%9C%92",
    zones:[ {type:"æ²³å£ï¼ˆã‚´ãƒ­ã‚¿ï¼‰", fishes:["ã‚·ãƒ¼ãƒã‚¹","ã‚¯ãƒ­ãƒ€ã‚¤","ãƒã‚¼"]} ],
    methods:["ãƒ«ã‚¢ãƒ¼","ã¶ã£ã“ã¿","ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ã‚¦ã‚­","ãƒ•ã‚«ã‚»"],
    shelf:"ã‚´ãƒ­ã‚¿ã®éš›ï¼ãƒ¨ãƒ¬ï¼æ½®ã®å‹•ãå‡ºã—",
    times:"æ½®ãŒå‹•ãã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼æœå¤•â—",
    rules:"è¶³å…ƒæ»‘ã‚Šæ³¨æ„ã€‚æœ€å¯„ã‚Šãƒˆã‚¤ãƒ¬ã¯æ–°ç ‚æ°´è¾ºå…¬åœ’ã€‚"
  },
  {
    id:"hirai-undo",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæˆ¸å·åŒº",
    name:"å¹³äº•é‹å‹•å…¬åœ’ï¼ˆè’å·Ã—æ—§ä¸­å·åˆæµåŸŸï¼‰",
    address:"æ±Ÿæˆ¸å·åŒºå¹³äº• è’å·ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å†…",
    map:"https://maps.google.com/?q=%E5%B9%B3%E4%BA%95%E9%81%8B%E5%8B%95%E5%85%AC%E5%9C%92%20%E8%8D%92%E5%B7%9D",
    zones:[ {type:"æ²³å·è­·å²¸/æ©‹è„š", fishes:["ã‚·ãƒ¼ãƒã‚¹","ãƒã‚¼","ã‚³ã‚¤","ã‚¦ãƒŠã‚®"]} ],
    methods:["ãƒ«ã‚¢ãƒ¼","ã¶ã£ã“ã¿","ã‚¦ã‚­","ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã¡ã‚‡ã„æŠ•ã’"],
    shelf:"æ©‹è„šæ˜æš—ï¼æ’æ°´æ©Ÿå ´ã®åè»¢æµï¼é§†ã‘ä¸ŠãŒã‚Š",
    times:"å¤œæ˜ã‘å‰å¾Œãƒ»å¤•ã¾ãšã‚",
    rules:"æ²³å·æ•·é§è»Šå ´ã¯åœŸæ—¥ç¥ã®ã¿é–‹æ”¾ã€‚"
  },
  {
    id:"tamagawa-daishi",
    pref:"æ±äº¬éƒ½", city:"å¤§ç”°åŒº",
    name:"å¤šæ‘©å·ãƒ»å¤§å¸«æ©‹ã€œç¾½ç”°ï¼ˆæ±äº¬éƒ½å´ï¼‰",
    address:"å¤§å¸«æ©‹å‘¨è¾ºã€œç¾½ç”°ç©ºæ¸¯å¯„ã‚Šæ²³å£",
    map:"https://maps.google.com/?q=%E5%A4%9A%E6%91%A9%E5%B7%9D%20%E5%A4%A7%E5%B8%AB%E6%A9%8B",
    zones:[ {type:"æ²³å£/è­·å²¸", fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´","ãƒã‚´ãƒ"]} ],
    methods:["ã¡ã‚‡ã„æŠ•ã’","ãƒ«ã‚¢ãƒ¼","ã‚¦ã‚­","ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼","ã¶ã£ã“ã¿"],
    shelf:"æ©‹è„šãƒ¨ãƒ¬ï¼æ½®ä½å¤‰åŒ–ã§å‹•ãã‚«ã‚±ä¸ŠãŒã‚Š",
    times:"ä¸‹ã’ã®å‹•ãå‡ºã—ï¼æœå¤•",
    rules:"æ¿ã‚Šå¾Œã«å¥½èª¿ãªæ—¥ã‚ã‚Šã€‚"
  },
  {
    id:"ooi-nagisa",
    pref:"æ±äº¬éƒ½", city:"å“å·åŒº/å¤§ç”°åŒº",
    name:"å¤§äº•ãµé ­ä¸­å¤®æµ·æµœå…¬åœ’ï¼ˆãªãã•ã®æ£®ï¼‰",
    address:"å“å·åŒºå…«æ½®4-2-1 å‘¨è¾º",
    map:"https://maps.google.com/?q=%E5%A4%A7%E4%BA%95%E3%81%B5%E9%A0%AD%E4%B8%AD%E5%A4%AE%E6%B5%B7%E6%B5%9C%E5%85%AC%E5%9C%92%20%E3%81%AA%E3%81%8E%E3%81%95%E3%81%AE%E6%A3%AE",
    zones:[ {type:"ç£¯çŠ¶è­·å²¸", fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","ãƒ«ã‚¢ãƒ¼","ã¡ã‚‡ã„æŠ•ã’"],
    shelf:"ã‚´ãƒ­ã‚¿ã®ç©´ãƒ»å²©é™°ã®è¶…è¿‘è·é›¢",
    times:"ãƒ‡ã‚¤ã§OKï¼ˆãƒ•ã‚¡ãƒŸãƒªãƒ¼â—ï¼‰",
    rules:"ç«‹å…¥ãƒ»é‡£ã‚Šç¦æ­¢åŒºç”»ã‚ã‚Šï¼å±é™ºãªæŠ•ã’é‡£ã‚Šç¦æ­¢ã€‚"
  },
  {
    id:"yokojikken",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"æ¨ªåé–“å·è¦ªæ°´å…¬åœ’ï¼ˆé‹æ²³ï¼‰",
    address:"å¤§å³¶ãƒ»åŒ—ç ‚å‘¨è¾º",
    map:"https://maps.google.com/?q=%E6%A8%AA%E5%8D%81%E9%96%93%E5%B7%9D%E8%A6%AA%E6%B0%B4%E5%85%AC%E5%9C%92",
    zones:[ {type:"é‹æ²³", fishes:["ãƒã‚¼","ãƒ†ãƒŠã‚¬ã‚¨ãƒ“"]} ],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","å°ã‚¦ã‚­","ã‚¦ã‚­"],
    shelf:"è¶³å…ƒéš›ãƒ»æ©‹å‘¨ã‚Šã®é™°",
    times:"å¤ã€œåˆç§‹ã®ãƒ‡ã‚¤/å¤•æ–¹â—",
    rules:"ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘ã€‚"
  },
  {
    id:"mizumoto",
    pref:"æ±äº¬éƒ½", city:"è‘›é£¾åŒº",
    name:"æ°´å…ƒå…¬åœ’ï¼ˆæ·¡æ°´ï¼šæ± ãƒ»æ°´è·¯ï¼‰",
    address:"è‘›é£¾åŒº æ°´å…ƒå…¬åœ’",
    map:"https://maps.google.com/?q=%E6%B0%B4%E5%85%83%E5%85%AC%E5%9C%92",
    zones:[ {type:"æ± ãƒ»æ°´è·¯", fishes:["ã‚³ã‚¤","ãƒ•ãƒŠ","ãƒ˜ãƒ©ãƒ–ãƒŠ","ãƒ†ãƒŠã‚¬ã‚¨ãƒ“"]} ],
    methods:["ã‚¦ã‚­ï¼ˆã‚¨ã‚µé‡£ã‚Šï¼‰","ãƒŸãƒ£ã‚¯é‡£ã‚Š"],
    shelf:"æ°´è·¯ãƒ»ãƒ¯ãƒ³ãƒ‰ã®ã‚«ã‚±ä¸ŠãŒã‚Šï¼æ­ã¾ã‚ã‚Š",
    times:"æ—¥ä¸­ã§OKï¼ˆæ··é›‘æ³¨æ„ï¼‰",
    rules:"ç„¡æ–™ï¼ˆä¸€éƒ¨æ–½è¨­é™¤ãï¼‰ã€‚é§è»Šå ´ãƒ»ãƒˆã‚¤ãƒ¬å¤šæ•°ã€‚"
  }
];

/* éƒ½é“åºœçœŒä¸€è¦§ */
const PREFS = [...new Set(DB.map(p=>p.pref))];

/* ===== çŠ¶æ…‹ ===== */
const state = { step:0, pref:null, placeId:null, zoneIdx:null, fish:null, method:null };
const stepsTitle = ["éƒ½é“åºœçœŒ","é‡£ã‚Šå ´","ãƒã‚¤ãƒ³ãƒˆç¨®åˆ¥","é­šç¨®","é‡£ã‚Šæ–¹","çµæœ"];

function setSteps(){
  const s = document.getElementById('steps');
  s.innerHTML = stepsTitle.map((t,i)=>`<div class="step ${i<=state.step?'on':''}">${i+1}. ${t}</div>`).join('');
  document.getElementById('back').hidden = state.step===0;
}

/* ===== æç”» ===== */
function render(){
  setSteps();
  const app = document.getElementById('app');

  // 0: éƒ½é“åºœçœŒ
  if(state.step===0){
    app.innerHTML = `<div class="hero"><strong>éƒ½é“åºœçœŒ</strong> ã‚’é¸ã¶ã¨ã€ãã®åœ°åŸŸã®é‡£ã‚Šå ´ãŒå‡ºã¾ã™ã€‚</div>
    <div class="grid">
      ${PREFS.map(p=>{
        const n = DB.filter(d=>d.pref===p).length;
        return `<div class="card">
          <h3>${p}</h3>
          <p class="muted">${n} ã‚¹ãƒãƒƒãƒˆ</p>
          <div class="row"><button class="pri" onclick="selPref('${p}')">ã“ã®éƒ½é“åºœçœŒã‚’é¸ã¶</button></div>
        </div>`}).join('')}
    </div>`;
    return;
  }

  // 1: é‡£ã‚Šå ´
  if(state.step===1){
    const list = DB.filter(d=>d.pref===state.pref);
    app.innerHTML = `<div class="grid">
      ${list.map(d=>`
        <div class="card">
          <h3>${d.name}</h3>
          <div class="kv"><span>${d.pref} ${d.city||""}</span><span>${d.address||""}</span></div>
          <div class="row">
            <button class="ghost" onclick="openMap('${d.id}')">åœ°å›³ã‚’é–‹ã</button>
            <button class="pri" onclick="selPlace('${d.id}')">ã“ã“ã‚’é¸ã¶</button>
          </div>
        </div>`).join('')}
    </div>`;
    return;
  }

  // 2: ãƒã‚¤ãƒ³ãƒˆç¨®åˆ¥
  if(state.step===2){
    const p = getPlace();
    app.innerHTML = `
      <div class="card">
        <h3>${p.name}ï½œãƒã‚¤ãƒ³ãƒˆã‚’é¸ã¶</h3>
        <div class="chips">
          ${p.zones.map((z,idx)=>`<button class="chip" onclick="selZone(${idx})">${z.type}</button>`).join('')}
        </div>
      </div>`;
    return;
  }

  // 3: é­šç¨®ï¼ˆãƒã‚¤ãƒ³ãƒˆã§çµã‚Šè¾¼ã¿ï¼‰
  if(state.step===3){
    const z = getZone();
    app.innerHTML = `
      <div class="card">
        <h3>${getPlace().name}ï½œ${z.type}ï½œé­šç¨®ã‚’é¸ã¶</h3>
        <div class="chips">
          ${z.fishes.map(f=>`<button class="chip" onclick="selFish('${f}')">${f}</button>`).join('')}
        </div>
      </div>`;
    return;
  }

  // 4: é‡£ã‚Šæ–¹ï¼ˆé­šç¨®ã§è‡ªå‹•ãƒ•ã‚£ãƒ«ã‚¿ & ãã®å ´æ‰€ã§å¯èƒ½ãªã‚‚ã®ã«é™å®šï¼‰
  if(state.step===4){
    const p = getPlace();
    const allowedByFish = (FISH_METHODS[state.fish]||[]);
    const allowed = allowedByFish.filter(m => (p.methods||[]).includes(m));
    app.innerHTML = `
      <div class="card">
        <h3>${p.name}ï½œ${getZone().type}ï½œ${state.fish} ã®é‡£ã‚Šæ–¹</h3>
        <div class="chips">
          ${allowed.map(m=>`<button class="chip" onclick="selMethod('${m}')">${m}</button>`).join('') || '<p class="muted">ã“ã®é­šç¨®ã®æ¨å¥¨é‡£æ³•ãƒ‡ãƒ¼ã‚¿ãŒæœªè¨­å®šã§ã™</p>'}
        </div>
      </div>`;
    return;
  }

  // 5: çµæœï¼ˆã”æŒ‡å®šã®é †ã§è¡¨ç¤ºï¼‰
  if(state.step===5){
    const p = getPlace(), z = getZone();
    const links = LINKS_BY_FISH[state.fish] || [];
    const baitLinks = BAIT_BY_METHOD[state.method] || [];
    const fimg = fishImg(state.fish);
    const rimg = rigImg(state.fish, state.method);

    app.innerHTML = `
      <div class="card">
        ${fimg ? `
          <div class="sectionTitle">æŒ‡å®šã—ãŸé­šç”»åƒ â†“</div>
          <img class="banner" src="${fimg}" alt="${state.fish}" onerror="this.style.display='none'">` : ''}

        ${rimg ? `
          <div class="sectionTitle">ä»•æ›ã‘ã‚¤ãƒ©ã‚¹ãƒˆ â†“</div>
          <img class="banner" src="${rimg}" alt="${state.method} rig" onerror="this.style.display='none'">` : ''}

        <h3 style="margin-top:10px">${p.name}</h3>
        <div class="kv">
          <span>${z.type}</span><span>é­šç¨®ï¼š${state.fish}</span><span>é‡£ã‚Šæ–¹ï¼š${state.method}</span>
        </div>

        <div class="sectionTitle">ã‚ªã‚¹ã‚¹ãƒ¡éƒ¨æ â†“</div>
        ${links.length ? `<ul class="items">
          ${links.map(i=>`<li>${i.label}
              <div class="shops">
                <a class="shop" href="#" onclick="ext('${i.a}')">Amazon</a>
                <a class="shop" href="#" onclick="ext('${i.r}')">æ¥½å¤©</a>
              </div>
            </li>`).join('')}
        </ul>` : '<p class="muted">ã“ã®é­šç¨®ã®éƒ¨æãƒªãƒ³ã‚¯ã¯æº–å‚™ä¸­</p>'}

        <div class="sectionTitle">é¤Œãƒ»æ’’ãé¤Œã®ã‚ªã‚¹ã‚¹ãƒ¡ï¼ˆé‡£ã‚Šæ–¹åˆ¥ï¼‰ â†“</div>
        ${baitLinks.length ? `<ul class="items">
          ${baitLinks.map(i=>`<li>${i.label}
              <div class="shops">
                <a class="shop" href="#" onclick="ext('${i.a}')">Amazon</a>
                <a class="shop" href="#" onclick="ext('${i.r}')">æ¥½å¤©</a>
              </div>
            </li>`).join('')}
        </ul>` : '<p class="muted">ã“ã®é‡£ã‚Šæ–¹ã®é¤Œãƒ»æ’’ãé¤Œãƒªãƒ³ã‚¯ã¯æº–å‚™ä¸­</p>'}

        <div class="sectionTitle">æ£šã€ç‹™ã„ç›® â†“</div>
        <p>${p.shelf}</p>

        <div class="sectionTitle">ã‚ªã‚¹ã‚¹ãƒ¡æ™‚é–“å¸¯ â†“</div>
        <p>${p.times||'æœå¤•ãŒåŸºæœ¬ã€‚æ½®ã®å‹•ãå‡ºã—ã‚’é‡è¦–ã€‚'}</p>

        <div class="sectionTitle">ç¾åœ°ãƒ«ãƒ¼ãƒ«ï¼ˆå‚™è€ƒï¼‰ â†“</div>
        <p class="muted">${p.rules||'å®‰å…¨ç¬¬ä¸€ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚'}</p>

        <div class="sectionTitle">å ´æ‰€ã¨å‹ã ã¡å…±æœ‰</div>
        <div class="row" style="margin-top:6px">
          <button class="ghost" onclick="openMap('${p.id}')">å ´æ‰€ã‚’åœ°å›³ã§ç¢ºèª</button>
          <button class="pri" onclick="share()">å‹ã ã¡ã«å…±æœ‰</button>
        </div>
      </div>`;
    return;
  }
}

/* ===== é¸æŠãƒãƒ³ãƒ‰ãƒ© ===== */
function toSlug(s){ return (s||'').toString().toLowerCase().replace(/[^\w]+/g,'-'); }
function getPlace(){ return DB.find(p=>p.id===state.placeId); }
function getZone(){ const p = getPlace(); return p?.zones?.[state.zoneIdx]; }
function openWin(url){ return liff.isInClient()? liff.openWindow({url, external:true}) : window.open(url,'_blank'); }
function openMap(pid){ const url = DB.find(p=>p.id===pid).map; openWin(url); }
function ext(url){ openWin(url); }

function selPref(p){ state.pref=p; state.step=1; render(); }
function selPlace(id){ state.placeId=id; state.step=2; render(); }
function selZone(idx){ state.zoneIdx=idx; state.step=3; render(); }
function selFish(f){ state.fish=f; state.step=4; render(); }
function selMethod(m){ state.method=m; state.step=5; render(); }

function goBack(){
  if(state.step===0) return;
  if(state.step===1){ state.pref=null; }
  if(state.step===2){ state.placeId=null; }
  if(state.step===3){ state.zoneIdx=null; }
  if(state.step===4){ state.fish=null; }
  if(state.step===5){ state.method=null; }
  state.step--; render();
}

/* ===== LIFF èµ·å‹• ===== */
(async()=>{
  await liff.init({ liffId: LIFF_ID });
  if (liff.isInClient()){
    if(!liff.isLoggedIn()){ liff.login({ prompt:"consent" }); return; }
    try{
      const p = await liff.getProfile();
      document.getElementById('hello').textContent = `ã‚ˆã†ã“ã ${p.displayName} ã•ã‚“`;
    }catch{ document.getElementById('hello').textContent = "ã‚ˆã†ã“ãï¼"; }
  }else{
    document.getElementById('hello').textContent = "ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­";
  }
  render();
})();

async function share(){
  if(!liff.isInClient()){ alert('å…±æœ‰ã¯LINEã‚¢ãƒ—ãƒªå†…ã§é–‹ã„ã¦ãã ã•ã„'); return; }
  const p = getPlace(), z = getZone();
  const msg = `${p.name}\n${z.type}\n${state.fish} Ã— ${state.method}\næ£š: ${p.shelf}\næ™‚é–“å¸¯: ${p.times||'æœå¤•'}\nåœ°å›³: ${p.map}`;
  await liff.shareTargetPicker([{ type:'text', text: msg }]);
}
</script>
</body>
</html>
