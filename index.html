<!doctype html><html lang="ja"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>RigNavi</title>
 
<!-- LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<!-- ã§ãã‚‹ã ã‘ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æŠ‘æ­¢ -->
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<style>
:root{
  /* â”€â”€ æµ·ã£ã½ã„ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  --bg1:#071a2b; --bg2:#0b2742;             /* èƒŒæ™¯ã‚°ãƒ©ãƒ‡ */
  --card:#0f2f4a;                           /* ã‚«ãƒ¼ãƒ‰ç´º */
  --line:#1a4266;                           /* æ ç·š */
  --txt:#e9f4ff;                            /* æ–‡å­—ï¼ˆæ˜ï¼‰ */
  --muted:#b9d3e7;                          /* è£œåŠ©æ–‡å­— */
  --pri:#22d3ee; --pri2:#3b82f6;            /* ã‚¢ã‚¯ã‚¢ç³»ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
  --shadow:0 10px 26px rgba(5,42,75,.28);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;color:var(--txt);
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:system-ui, -apple-system, "Segoe UI", Helvetica, Arial, "Hiragino Kaku Gothic ProN", "Meiryo", sans-serif;
}
a{color:inherit}
.container{max-width:980px;margin:0 auto;padding:18px}

.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.brand{font-weight:800;letter-spacing:.2px}
.badge{background:linear-gradient(90deg,var(--pri),var(--pri2));color:#022436;
  padding:4px 10px;border-radius:999px;font-size:12px;font-weight:800}

.hello{color:var(--muted);margin:2px 0 14px}

.stepper{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:8px 0 16px}
.step{background:var(--card);border:1px solid var(--line);color:var(--muted);
  padding:10px 12px;border-radius:12px;display:flex;align-items:center;gap:8px;box-shadow:var(--shadow)}
.step.active{border-color:var(--pri); color:#d9f7ff; background:linear-gradient(180deg,#123756,#0f2f4a)}
.step .num{width:22px;height:22px;border-radius:999px;background:#0d3d61;
  display:grid;place-items:center;font-size:12px;color:#aeeaff;font-weight:800}

.grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:12px}
@media(min-width:640px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
@media(min-width:900px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}

.card{background:var(--card);border:1px solid var(--line);border-radius:14px;
  padding:14px;box-shadow:var(--shadow);transition:.15s transform}
.card:hover{transform:translateY(-2px)}
.card h3{margin:0 0 6px;font-size:16px}
.card p{margin:0;color:var(--muted);font-size:13px}
.small{font-size:12px;color:var(--muted)}

.tag{display:inline-block;padding:6px 10px;border-radius:999px;background:#0d3d61;color:#c9eeff;font-size:12px}
.btn{background:linear-gradient(90deg,var(--pri),var(--pri2));border:none;color:#022436;
  font-weight:800;padding:12px 14px;border-radius:10px;box-shadow:var(--shadow);cursor:pointer}
.btn.secondary{background:#0e3c61;color:#e9f4ff;border:1px solid var(--line)}

.section{background:var(--card);border:1px solid var(--line);border-radius:16px;
  padding:16px;box-shadow:var(--shadow)}
.section h2{margin:0 0 10px}

.row{display:flex;gap:10px;flex-wrap:wrap}
.item{flex:1 1 240px;border:1px dashed #2a567a;border-radius:10px;padding:10px;background:#0d2a44}
.hero{width:100%;border-radius:12px;margin:6px 0;aspect-ratio:16/9;object-fit:cover;border:1px solid var(--line)}

.input{width:100%;background:#0d2a44;border:1px solid var(--line);color:var(--txt);
  padding:10px 12px;border-radius:10px;outline:none}
.search{display:flex;gap:8px;margin-bottom:10px}
</style>
</head><body>
<div class="container">
  <div class="header">
    <div class="brand">ğŸ£ RigNavi</div>
    <div class="badge">MVP</div>
  </div>
  <div id="hello" class="hello">èµ·å‹•ä¸­...</div>

  <div class="stepper">
    <div class="step" id="st1"><span class="num">1</span>é‡£ã‚Šå ´æ‰€</div>
    <div class="step" id="st2"><span class="num">2</span>é‡£ã‚Šãƒã‚¤ãƒ³ãƒˆ</div>
    <div class="step" id="st3"><span class="num">3</span>é­šç¨®</div>
    <div class="step" id="st4"><span class="num">4</span>é‡£ã‚Šæ–¹</div>
  </div>

  <div id="view"></div>
</div>

<script>
/* ========== åŸºæœ¬è¨­å®šï¼ˆå¿…è¦æ™‚ã ã‘ç·¨é›†ï¼‰ ========== */
const LIFF_ID = "2008257307-RwPLYWG1";
const VERSION = "3"; // â†å…¬é–‹ã®ãŸã³ã«ä¸Šã’ã‚‹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ï¼‰
const LIFF_URL = `https://liff.line.me/${LIFF_ID}?v=${VERSION}`;

/* ========== ãƒ‡ãƒ¼ã‚¿ ========== */
/* é‡£ã‚Šå ´æ‰€ â†’ é‡£ã‚Šãƒã‚¤ãƒ³ãƒˆ â†’ é­šç¨® â†’ é‡£ã‚Šæ–¹ â†’ æ¨å¥¨ãƒ—ãƒ©ãƒ³ */
const DB = [
  {
    id:"daikoku",
    name:"å¤§é»’é‡£ã‚Šå…¬åœ’",
    address:"ç¥å¥ˆå·çœŒæ¨ªæµœå¸‚é¶´è¦‹åŒº å¤§é»’ãµé ­",
    map:"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent("å¤§é»’é‡£ã‚Šå…¬åœ’"),
    types:[
      {
        id:"teibo", name:"å ¤é˜²", desc:"è¶³å ´è‰¯å¥½ãƒ»å¸¸å¤œç¯ã‚ã‚Š",
        fishes:[
          {
            id:"aji", name:"ã‚¢ã‚¸",
            methods:[
              { id:"sabiki", name:"ã‚µãƒ“ã‚­", plan:{
                title:"è¶³å…ƒã®å›éŠã§æ•°é‡£ã‚Šï¼ˆå ¤é˜²ã‚µãƒ“ã‚­ï¼‰",
                hero:"https://images.unsplash.com/photo-1524712245354-c8471b98e76c?q=80&w=1200&auto=format&fit=crop",
                point:"å¸¸å¤œç¯ã®æ˜æš—å¢ƒãƒ»è¶³å…ƒå›éŠã®ç­‹",
                depth:"è¡¨å±¤ã€œä¸­å±¤ï¼ˆ1måˆ»ã¿ã§æ¢ã‚‹ï¼‰",
                how:"10å›/åˆ†ãã‚‰ã„ã®ãƒ†ãƒ³ãƒã§ä¸Šä¸‹ã€‚ç¾¤ã‚ŒãŒä»˜ã„ãŸå±¤ã‚’ã‚­ãƒ¼ãƒ—ã€‚",
                gear:{ rig:"ã‚µãƒ“ã‚­ 4ã€œ6å· + å°å‹ã‚«ã‚´", line:"ãƒŠã‚¤ãƒ­ãƒ³2ã€œ3å· / ãƒãƒªã‚¹1.5å·", option:"å¤œã¯ã‚±ãƒŸã§è¦–èªæ€§UP" },
                parts:[
                  {label:"ã‚µãƒ“ã‚­ä»•æ›ã‘ 5å·", url:"https://www.amazon.co.jp/s?k=%E3%82%B5%E3%83%93%E3%82%AD+5%E5%8F%B7&tag=yourtag-22"},
                  {label:"ã‚«ã‚´å° + ãƒŠã‚¹å‹8å·", url:"https://www.amazon.co.jp/s?k=%E9%87%A3%E3%82%8A+%E3%82%AB%E3%82%B4+%E5%B0%8F&tag=yourtag-22"}
                ]
              }},
              { id:"uki", name:"ã‚¦ã‚­", plan:{
                title:"é›»æ°—ã‚¦ã‚­ã§å›éŠå¾…ã¡",
                hero:"https://images.unsplash.com/photo-1508855901852-97c5b3b5b6cd?q=80&w=1200&auto=format&fit=crop",
                point:"å¸¸å¤œç¯å‘¨è¾ºã®æ½®ãŒåŠ¹ãç­‹",
                depth:"1.0ã€œ1.8mã‚’å¾®èª¿æ•´",
                how:"æ™‚ã€…ã‚†ã£ãã‚Šå¼•ã„ã¦èª˜ã„ã€‚ã‚¢ã‚¿ãƒªå±¤ã‚’30cmåˆ»ã¿ã§ã€‚",
                gear:{ rig:"é›»æ°—ã‚¦ã‚­ 0.5ã€œ1å·", line:"ãƒŠã‚¤ãƒ­ãƒ³3å·", option:"ã‚¬ãƒ³ç‰G5" },
                parts:[
                  {label:"é›»æ°—ã‚¦ã‚­ 1å·", url:"https://www.amazon.co.jp/s?k=%E9%9B%BB%E6%B0%97%E3%82%A6%E3%82%AD+1%E5%8F%B7&tag=yourtag-22"},
                  {label:"ã‚µãƒ«ã‚«ãƒ³/ãƒãƒªã‚¹", url:"https://www.amazon.co.jp/s?k=%E3%82%B5%E3%83%AB%E3%82%AB%E3%83%B3+%E3%83%8F%E3%83%AA%E3%82%B9&tag=yourtag-22"}
                ]
              }}
            ]
          },
          {
            id:"mebaru", name:"ãƒ¡ãƒãƒ«",
            methods:[
              { id:"lure", name:"ãƒ«ã‚¢ãƒ¼", plan:{
                title:"å¸¸å¤œç¯ãƒ¡ãƒãƒªãƒ³ã‚°ï¼ˆã‚¸ã‚°å˜ï¼‰",
                hero:"https://images.unsplash.com/photo-1558981285-6f0c94958bb6?q=80&w=1200&auto=format&fit=crop",
                point:"å²¸å£éš›ã€æ˜æš—å¢ƒã€åè»¢æµ",
                depth:"è¡¨å±¤ãƒ‰ãƒªãƒ•ãƒˆ â†’ ä¸­å±¤ãƒ¬ãƒ³ã‚¸ã‚­ãƒ¼ãƒ—",
                how:"1gã‚¸ã‚°ãƒ˜ãƒƒãƒ‰ï¼‹1.5inãƒ¯ãƒ¼ãƒ ã‚’è¶…ã‚¹ãƒ­ãƒ¼å·»ã",
                gear:{ rig:"1gã‚¸ã‚°ãƒ˜ãƒƒãƒ‰ï¼‹1.5inãƒ¯ãƒ¼ãƒ ", line:"PE0.2 + ï¾Œï¾›ï¾›0.8", option:"ã‚¹ãƒŠãƒƒãƒ—å°ã§äº¤æ›æ¥½ã«" },
                parts:[
                  {label:"ã‚¸ã‚°ãƒ˜ãƒƒãƒ‰1g", url:"https://www.amazon.co.jp/s?k=%E3%82%B8%E3%82%B0%E3%83%98%E3%83%83%E3%83%89+1g&tag=yourtag-22"},
                  {label:"ãƒ¡ãƒãƒ«ãƒ¯ãƒ¼ãƒ 1.5in", url:"https://www.amazon.co.jp/s?k=%E3%83%A1%E3%83%90%E3%83%AA+%E3%83%AF%E3%83%BC%E3%83%A0&tag=yourtag-22"}
                ]
              }}
            ]
          }
        ]
      },
      {
        id:"tetra", name:"ãƒ†ãƒˆãƒ©", desc:"æ ¹å›ã‚Šãƒ»ã‚¹ãƒªãƒƒãƒˆç‹™ã„",
        fishes:[
          { id:"kasago", name:"ã‚«ã‚µã‚´",
            methods:[
              { id:"burakuri", name:"ãƒ–ãƒ©ã‚¯ãƒª", plan:{
                title:"ç©´æ’ƒã¡ã§æ ¹é­šæ”»ç•¥",
                hero:"https://images.unsplash.com/photo-1471864190281-a93a3070b6de?q=80&w=1200&auto=format&fit=crop",
                point:"ãƒ†ãƒˆãƒ©ã®éš™é–“ãƒ»è½ã¡è¾¼ã¿",
                depth:"ãƒœãƒˆãƒ ã€œ30cmä¸Š",
                how:"ç©´ã«è½ã¨ã—ã¦3ã€œ5ç§’å¾…ã¡â†’å°ã•ãèª˜ã„ä¸Šã’",
                gear:{ rig:"ãƒ–ãƒ©ã‚¯ãƒª2ã€œ4å· + é’ã‚¤ã‚½/ã‚ªã‚­ã‚¢ãƒŸ", line:"ãƒ•ãƒ­ãƒ­3ã€œ4å·", option:"æ ¹ã‚ºãƒ¬å¯¾ç­–ã§ãƒªãƒ¼ãƒ€ãƒ¼é•·ã‚" },
                parts:[
                  {label:"ãƒ–ãƒ©ã‚¯ãƒª3å·", url:"https://www.amazon.co.jp/s?k=%E3%83%96%E3%83%A9%E3%82%AF%E3%83%AA&tag=yourtag-22"},
                  {label:"ãƒ•ãƒ­ãƒ­ã‚«ãƒ¼ãƒœãƒ³ 4å·", url:"https://www.amazon.co.jp/s?k=%E3%83%95%E3%83%AD%E3%83%AD+4%E5%8F%B7&tag=yourtag-22"}
                ]
              }}
            ]
          }
        ]
      }
    ]
  },

  {
    id:"toushima-nishi",
    name:"æ±æ‰‡å³¶è¥¿å…¬åœ’",
    address:"ç¥å¥ˆå·çœŒå·å´å¸‚å·å´åŒº æ±æ‰‡å³¶",
    map:"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent("æ±æ‰‡å³¶è¥¿å…¬åœ’"),
    types:[
      { id:"teibo", name:"å ¤é˜²", desc:"åºƒã„ç›´ç·šè­·å²¸",
        fishes:[
          { id:"saba", name:"ã‚µãƒ",
            methods:[
              { id:"float", name:"ã‚«ã‚´é æŠ•", plan:{
                title:"æœå¤•ã®å›éŠã‚’åºƒç¯„å›²ã«æ¢ã‚‹",
                hero:"https://images.unsplash.com/photo-1508161773455-3ada8ed2bbd9?q=80&w=1200&auto=format&fit=crop",
                point:"æ½®ç›®ãƒ»ãƒŠãƒ–ãƒ©ãƒ»è¡¨å±¤å›éŠ",
                depth:"è¡¨å±¤ã€œä¸­å±¤",
                how:"ã‚¦ã‚­æ­¢ã‚ã§å±¤èª¿æ•´ã€‚æ—©å·»ãã§ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³èª˜ç™ºã€‚",
                gear:{ rig:"é æŠ•ã‚«ã‚´ + 3å·ãƒŠã‚¤ãƒ­ãƒ³", line:"ãƒŠã‚¤ãƒ­ãƒ³3å·", option:"ãƒ¡ã‚¿ãƒ«ã‚¸ã‚°20ã€œ30gã§ã‚‚OK" },
                parts:[
                  {label:"é æŠ•ã‚«ã‚´ã‚»ãƒƒãƒˆ", url:"https://www.amazon.co.jp/s?k=%E9%81%A0%E6%8A%95+%E3%82%AB%E3%82%B4&tag=yourtag-22"},
                  {label:"ãƒ¡ã‚¿ãƒ«ã‚¸ã‚°30g", url:"https://www.amazon.co.jp/s?k=%E3%83%A1%E3%82%BF%E3%83%AB%E3%82%B8%E3%82%B0+30g&tag=yourtag-22"}
                ]
              }}
            ]
          },
          { id:"seabass", name:"ã‚·ãƒ¼ãƒã‚¹",
            methods:[
              { id:"lure", name:"ãƒ«ã‚¢ãƒ¼", plan:{
                title:"å¸¸å¤œç¯å‘¨ã‚Šã®å›éŠå¾…ã¡ï¼ˆãƒŸãƒãƒ¼ï¼‰",
                hero:"https://images.unsplash.com/photo-1487956382158-bb926046304a?q=80&w=1200&auto=format&fit=crop",
                point:"æ˜æš—å¢ƒãƒ»å²¸å£éš›ã®åè»¢æµ",
                depth:"è¡¨å±¤ã€œä¸­å±¤",
                how:"ãŸã å·»ãï¼‹ãƒˆã‚¥ã‚¤ãƒƒãƒã§ã‚¹ã‚¤ãƒƒãƒON",
                gear:{ rig:"9cmã‚¯ãƒ©ã‚¹ã®ãƒŸãƒãƒ¼", line:"PE1.0 + ï¾Œï¾›ï¾›4", option:"ã‚¹ãƒŠãƒƒãƒ—#1" },
                parts:[
                  {label:"ãƒŸãƒãƒ¼ 9cm", url:"https://www.amazon.co.jp/s?k=%E3%83%9F%E3%83%8E%E3%83%BC+9cm&tag=yourtag-22"},
                  {label:"ã‚·ãƒ§ãƒƒã‚¯ãƒªãƒ¼ãƒ€ãƒ¼4å·", url:"https://www.amazon.co.jp/s?k=%E3%83%AA%E3%83%BC%E3%83%80%E3%83%BC+4%E5%8F%B7&tag=yourtag-22"}
                ]
              }}
            ]
          }
        ]
      },
      { id:"kawaguchi", name:"æ²³å£ä»˜è¿‘", desc:"æµå¿ƒã¨ãƒ¨ãƒ¬",
        fishes:[
          { id:"kurodai", name:"ã‚¯ãƒ­ãƒ€ã‚¤",
            methods:[
              { id:"feed", name:"è½ã¨ã—è¾¼ã¿", plan:{
                title:"å£éš›ãƒ‰ãƒªãƒ•ãƒˆã§ã‚¯ãƒ­ãƒ€ã‚¤ç‹™ã„",
                hero:"https://images.unsplash.com/photo-1544551763-7ef25f88c5f5?q=80&w=1200&auto=format&fit=crop",
                point:"ã‚±ãƒ¼ã‚½ãƒ³ç¶™ãç›®ãƒ»éšœå®³ç‰©å‘¨ã‚Š",
                depth:"è¡¨å±¤ã€œ1m",
                how:"ã‚¨ã‚µã‚’æµã‚Œã«åŒèª¿ã€‚é€ã‚Šè¾¼ã¿éãã«æ³¨æ„ã€‚",
                gear:{ rig:"è½ã¨ã—è¾¼ã¿ä»•æ›ã‘", line:"PE1.2 + ï¾Œï¾›ï¾›3", option:"ã‚¬ãƒ³ç‰ã§æ²ˆä¸‹é€Ÿåº¦èª¿æ•´" },
                parts:[
                  {label:"ãƒãƒŒé‡2å·", url:"https://www.amazon.co.jp/s?k=%E3%83%81%E3%83%8C%E9%87%A3%E3%82%8A+%E9%87%9D&tag=yourtag-22"},
                  {label:"ã‚¬ãƒ³ç‰ G5", url:"https://www.amazon.co.jp/s?k=%E3%82%AC%E3%83%B3%E7%8E%89+G5&tag=yourtag-22"}
                ]
              }}
            ]
          }
        ]
      }
    ]
  },

  {
    id:"kemigawa",
    name:"æ¤œè¦‹å·è¥¿çªå ¤",
    address:"åƒè‘‰çœŒåƒè‘‰å¸‚ç¾æµœåŒº ç£¯è¾º",
    map:"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent("æ¤œè¦‹å· è¥¿çªå ¤"),
    types:[
      { id:"teibo", name:"å ¤é˜²", desc:"å¤–æ´‹å‘ãå…ˆç«¯ãŒç‹™ã„ç›®",
        fishes:[
          { id:"aji", name:"ã‚¢ã‚¸", methods:[
            { id:"sabiki", name:"ã‚µãƒ“ã‚­", plan:{
              title:"å¤•ã¾ãšã‚ã®å›éŠã§æ‰‹è¿”ã—å‹è² ",
              hero:"https://images.unsplash.com/photo-1517999349371-c43520457b23?q=80&w=1200&auto=format&fit=crop",
              point:"å…ˆç«¯ã®æ½®é€šã—ãƒ»å¸¸å¤œç¯å‘¨ã‚Š",
              depth:"è¡¨å±¤ã€œä¸­å±¤",
              how:"è¶³å…ƒã¨è»½ã„æŠ•ã’ã‚’ãƒ­ãƒ¼ãƒ†ã€‚",
              gear:{ rig:"ã‚µãƒ“ã‚­ 5å· + ã‚«ã‚´", line:"ãƒŠã‚¤ãƒ­ãƒ³2ã€œ3å·", option:"é›†é­šæ¿ã§å¯„ã›å¼·åŒ–" },
              parts:[
                {label:"ã‚µãƒ“ã‚­5å·", url:"https://www.amazon.co.jp/s?k=%E3%82%B5%E3%83%93%E3%82%AD+5%E5%8F%B7&tag=yourtag-22"},
                {label:"é›†é­šæ¿", url:"https://www.amazon.co.jp/s?k=%E9%9B%86%E9%AD%9A%E6%9D%BF&tag=yourtag-22"}
              ]
            }}
          ] }
        ]
      },
      { id:"surf", name:"ã‚µãƒ¼ãƒ•", desc:"é æµ…ã®ç ‚æµœãƒ»é›¢å²¸æµ",
        fishes:[
          { id:"hirame", name:"ãƒ’ãƒ©ãƒ¡", methods:[
            { id:"lure", name:"ãƒ«ã‚¢ãƒ¼", plan:{
              title:"ãƒŸãƒãƒ¼/ã‚·ãƒ³ãƒšãƒ³ã§ãƒ•ãƒ©ãƒƒãƒˆç‹™ã„",
              hero:"https://images.unsplash.com/photo-1455216205476-8e8b3410dde6?q=80&w=1200&auto=format&fit=crop",
              point:"é›¢å²¸æµã®ãƒ¨ãƒ¬ã¨åœ°å½¢å¤‰åŒ–ãƒ©ã‚¤ãƒ³",
              depth:"ä¸­å±¤ã€œãƒœãƒˆãƒ ",
              how:"ãŸã å·»ãï¼‹æ™‚ã€…ã‚¹ãƒˆãƒƒãƒ—ã€‚æ³¢æ‰“ã¡éš›ã¾ã§é€šã™ã€‚",
              gear:{ rig:"30gã‚·ãƒ³ãƒšãƒ³/ãƒŸãƒãƒ¼", line:"PE1.0 + ï¾Œï¾›ï¾›4", option:"ã‚¹ãƒŠãƒƒãƒ—#1" },
              parts:[
                {label:"ã‚·ãƒ³ãƒšãƒ³30g", url:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%B3%E3%83%9A%E3%83%B3+30g&tag=yourtag-22"},
                {label:"ãƒªãƒ¼ãƒ€ãƒ¼4å·", url:"https://www.amazon.co.jp/s?k=%E3%83%AA%E3%83%BC%E3%83%80%E3%83%BC+4%E5%8F%B7+%E3%83%95%E3%83%AD%E3%83%AD&tag=yourtag-22"}
              ]
            }}
          ] }
        ]
      }
    ]
  }
];

/* ========== çŠ¶æ…‹ & ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆå ´æ‰€/ãƒã‚¤ãƒ³ãƒˆ/é­šç¨®/é‡£ã‚Šæ–¹ï¼‰ ========== */
let state = { place:null, type:null, fish:null, method:null };

function setState(key,val){
  state[key] = val;
  // ä¸‹ä½ã¯ã‚¯ãƒªã‚¢
  if(key==="place"){ state.type = state.fish = state.method = null; }
  if(key==="type"){  state.fish = state.method = null; }
  if(key==="fish"){  state.method = null; }
  // ãƒãƒƒã‚·ãƒ¥ã«åŒæœŸï¼ˆæ·±ã„ãƒªãƒ³ã‚¯å¯ï¼‰
  const hash = [state.place?.id,state.type?.id,state.fish?.id,state.method?.id].filter(Boolean).join("/");
  location.hash = hash?("#"+hash):"#";
  render();
}

function initFromHash(){
  const [pid,tid,fid,mid] = (location.hash.replace("#","")||"").split("/");
  const place = DB.find(p=>p.id===pid);
  const type  = place?.types.find(t=>t.id===tid);
  const fish  = type?.fishes.find(f=>f.id===fid);
  const method= fish?.methods.find(m=>m.id===mid);
  state = {place,type,fish,method};
}

/* ========== ãƒ“ãƒ¥ãƒ¼ ========== */
const $view = document.getElementById("view");

function stepActive(n){ [1,2,3,4].forEach(i=>document.getElementById('st'+i).classList.toggle('active', i===n)); }

function viewPlaces(){
  stepActive(1);
  $view.innerHTML = `
  <div class="section">
    <h2>é‡£ã‚Šå ´æ‰€ã‚’é¸ã¶</h2>
    <div class="search"><input id="q" class="input" placeholder="å ´æ‰€åã‚„åœ°åŸŸã§æ¤œç´¢ï¼ˆä¾‹: å¤§é»’, æ¤œè¦‹å·, å·å´ï¼‰"></div>
    <div class="grid" id="placeGrid"></div>
  </div>`;
  const $grid = document.getElementById('placeGrid');
  const draw = (list)=> $grid.innerHTML = list.map(p=>`
    <div class="card">
      <h3>${p.name}</h3>
      <p class="small">ä½æ‰€ï¼š${p.address}</p>
      <div style="display:flex; gap:8px; margin-top:10px">
        <button class="btn" onclick="pickPlace('${p.id}')">ã“ã®å ´æ‰€ã‚’é¸ã¶</button>
        <button class="btn secondary" onclick="openMap('${p.id}')">åœ°å›³ã‚’é–‹ã</button>
      </div>
    </div>`).join("");
  draw(DB);
  document.getElementById('q').oninput = (e)=>{
    const q = e.target.value.trim();
    if(!q) return draw(DB);
    const list = DB.filter(p=> (p.name+p.address).includes(q));
    draw(list);
  };
}

function viewTypes(){
  stepActive(2);
  const list = state.place.types;
  $view.innerHTML = `<div class="section">
    <h2>${state.place.name} <span class="tag">é‡£ã‚Šãƒã‚¤ãƒ³ãƒˆã‚’é¸ã¶</span></h2>
    <div class="grid">
      ${list.map(t=>`<div class="card">
        <h3>${t.name}</h3><p>${t.desc||""}</p>
        <div style="margin-top:8px"><button class="btn" onclick="pickType('${t.id}')">é¸æŠ</button></div>
      </div>`).join("")}
    </div>
    <div class="small" style="margin-top:10px">æˆ»ã‚‹: <a href="javascript:setState('place',null)">å ´æ‰€ä¸€è¦§</a></div>
  </div>`;
}

function viewFish(){
  stepActive(3);
  const list = state.type.fishes;
  $view.innerHTML = `<div class="section">
    <h2>${state.place.name} â€º ${state.type.name} <span class="tag">é­šç¨®ã‚’é¸ã¶</span></h2>
    <div class="grid">
      ${list.map(f=>`<div class="card">
        <h3>${f.name}</h3><p class="small">${state.type.desc||""}</p>
        <div style="margin-top:8px"><button class="btn" onclick="pickFish('${f.id}')">é¸æŠ</button></div>
      </div>`).join("")}
    </div>
  </div>`;
}

function viewMethods(){
  stepActive(4);
  const list = state.fish.methods;
  $view.innerHTML = `<div class="section">
    <h2>${state.place.name} â€º ${state.type.name} â€º ${state.fish.name} <span class="tag">é‡£ã‚Šæ–¹</span></h2>
    <div class="grid">
      ${list.map(m=>`<div class="card">
        <h3>${m.name}</h3><p>${m.plan.title}</p>
        <div style="margin-top:8px"><button class="btn" onclick="pickMethod('${m.id}')">è©³ç´°ã‚’è¦‹ã‚‹</button></div>
      </div>`).join("")}
    </div>
  </div>`;
}

function viewPlan(){
  const {place,type,fish,method} = state; const p = method.plan;
  $view.innerHTML = `
    <div class="section">
      <div class="small">ãƒ«ãƒ¼ãƒˆ: ${place.name} â€º ${type.name} â€º ${fish.name} â€º ${method.name}</div>
      <h2 style="margin-top:6px">${p.title}</h2>
      <img class="hero" src="${p.hero}" alt="">
      <div class="row">
        <div class="item"><b>ç‹™ã†ãƒã‚¤ãƒ³ãƒˆ</b><br>${p.point}</div>
        <div class="item"><b>ç‹™ã†æ£š</b><br>${p.depth}</div>
        <div class="item"><b>æ”»ã‚æ–¹ã®ã‚³ãƒ„</b><br>${p.how}</div>
      </div>
      <div class="row" style="margin-top:10px">
        <div class="item"><b>ä»•æ›ã‘</b><br>${p.gear.rig}</div>
        <div class="item"><b>ãƒ©ã‚¤ãƒ³</b><br>${p.gear.line}</div>
        <div class="item"><b>ã‚ªãƒ—ã‚·ãƒ§ãƒ³</b><br>${p.gear.option||'-'}</div>
      </div>
      <h3 style="margin:14px 0 8px">ãŠã™ã™ã‚éƒ¨æï¼ˆAmazonï¼‰</h3>
      <div class="grid">
        ${p.parts.map(it=>`<div class="card">
          <h3>${it.label}</h3><p class="small">Amazonã§è©³ç´°ã‚’ç¢ºèª</p>
          <button class="btn" onclick="ext('${it.url}')">Amazonã§è¦‹ã‚‹</button>
        </div>`).join('')}
      </div>
      <div style="display:flex; gap:8px; margin-top:14px; flex-wrap:wrap">
        <button class="btn secondary" onclick="backStep()">æˆ»ã‚‹</button>
        <button class="btn" onclick="sharePlan()">å‹ã ã¡ã«å…±æœ‰</button>
        <button class="btn secondary" onclick="openMap('${place.id}')">åœ°å›³ã‚’é–‹ã</button>
      </div>
    </div>`;
}

/* ========== ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ========== */
window.pickPlace = id => setState("place", DB.find(p=>p.id===id));
window.pickType  = id => setState("type",  state.place.types.find(t=>t.id===id));
window.pickFish  = id => setState("fish",  state.type.fishes.find(f=>f.id===id));
window.pickMethod= id => setState("method",state.fish.methods.find(m=>m.id===id));

window.backStep = ()=>{
  if(state.method){ setState("method",null); return; }
  if(state.fish){   setState("fish",null);   return; }
  if(state.type){   setState("type",null);   return; }
  setState("place",null);
};

window.openMap = (pid)=>{
  const url = DB.find(p=>p.id===pid).map;
  liff.openWindow({ url, external:true });
};

window.ext = url => liff.openWindow({ url, external:true });

function sharePlan(){
  const {place,type,fish,method} = state; const p = method.plan;
  if(!liff.isApiAvailable('shareTargetPicker')){ alert('å…±æœ‰ã¯LINEã‚¢ãƒ—ãƒªã‹ã‚‰'); return; }
  const flex = {
    type:"bubble",
    hero:{type:"image",url:p.hero, size:"full",aspectMode:"cover",aspectRatio:"16:9"},
    body:{type:"box",layout:"vertical",contents:[
      {type:"text",text:p.title,weight:"bold",wrap:true},
      {type:"text",text:`å ´æ‰€:${place.name} / ãƒã‚¤ãƒ³ãƒˆ:${type.name} / é­š:${fish.name} / é‡£æ³•:${method.name}`,size:"sm",color:"#666666",wrap:true,margin:"sm"},
      {type:"text",text:`ãƒã‚¤ãƒ³ãƒˆ:${p.point}`,wrap:true,size:"sm"},
      {type:"text",text:`æ£š:${p.depth}`,wrap:true,size:"sm"}
    ]},
    footer:{type:"box",layout:"vertical",spacing:"md",contents:[
      {type:"button",style:"primary",action:{type:"uri",label:"Amazonã‚’è¦‹ã‚‹",uri:p.parts[0]?.url || LIFF_URL}},
      {type:"button",style:"secondary",action:{type:"uri",label:"RigNaviã§é–‹ã",uri:`${LIFF_URL}#${place.id}/${type.id}/${fish.id}/${method.id}`}}
    ]}
  };
  liff.shareTargetPicker([{type:"flex",altText:p.title,contents:flex}]);
}

/* ========== ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°åˆ¶å¾¡ ========== */
function render(){
  const s=state;
  document.getElementById('st1').classList.toggle('active',!s.place);
  document.getElementById('st2').classList.toggle('active',s.place && !s.type);
  document.getElementById('st3').classList.toggle('active',s.type && !s.fish);
  document.getElementById('st4').classList.toggle('active',s.fish && !s.method);

  if(!s.place)  return viewPlaces();
  if(!s.type)   return viewTypes();
  if(!s.fish)   return viewFish();
  if(!s.method) return viewMeth
