<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RigNavi MVP</title>
<link rel="icon" href="data:,">

<!-- LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<!-- ===== Theme / Layout ===== -->
<style>
:root{
  --bg:#eef5ff;          /* 明るい海色ベース */
  --card:#ffffff;
  --ink:#11223a;
  --muted:#5b6b81;
  --accent:#17a2ff;
  --accent-2:#66d1ff;
  --chip:#e8f5ff;
  --shadow:0 8px 26px rgba(17,34,58,.12);
  --radius:16px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"ヒラギノ角ゴ ProN","Hiragino Kaku Gothic ProN","メイリオ",Meiryo,"Noto Sans JP","Yu Gothic UI","游ゴシック体",YuGothic,"MS PGothic",sans-serif}
a{color:#0b7cc4;text-decoration:none}
header{
  position:sticky;top:0;z-index:30;
  backdrop-filter:saturate(1.2) blur(10px);
  background:linear-gradient(180deg,rgba(255,255,255,.85),rgba(255,255,255,.75));
  border-bottom:1px solid rgba(0,0,0,.05);
}
.brand{padding:14px 18px;font-weight:800;display:flex;gap:8px;align-items:center}
.brand i{width:22px;height:22px;border-radius:6px;background:linear-gradient(135deg,#23b0ff,#005bff);display:inline-block}
.badge{margin-left:auto;margin-right:14px;padding:4px 10px;border-radius:999px;font-weight:700;background:#dff2ff;color:#0b6aa4}

.banner{
  margin:14px auto;max-width:1100px;padding:0 14px;
}
.banner a{
  display:block;border-radius:18px;overflow:hidden;border:1px solid rgba(0,0,0,.05);
  box-shadow:var(--shadow);background:#fff;
}
.banner img{display:block;width:100%;height:auto}

main{max-width:1100px;margin:8px auto;padding: 0 14px 28px}
#hello{margin:10px 0 16px;color:var(--muted)}

.row{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
.steps,.detail{flex:1 1 360px}

.card{
  background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
  border:1px solid rgba(0,0,0,.06);padding:16px
}

/* Step cards */
.stepCard{
  display:flex;align-items:center;gap:10px;
  padding:16px;border-radius:14px;background:#f6fbff;border:1px solid #e6f3ff;
  min-width:150px;box-shadow:0 4px 16px rgba(23,162,255,.08)
}
.stepCard b{background:var(--accent);color:#fff;border-radius:10px;padding:2px 8px}
.stepCard h4{margin:0;font-size:18px}

/* tiles */
.tiles{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:12px;margin-top:12px}
.tile{
  border-radius:14px;border:1px solid rgba(0,0,0,.06);background:#fff;padding:14px;box-shadow:var(--shadow);cursor:pointer
}
.tile h5{margin:0 0 6px 0;font-size:15px}
.meta{color:var(--muted);font-size:12px}
.memo{margin-top:6px;font-size:12px;color:#224c6f;background:#e8f5ff;border:1px dashed #bfe7ff;padding:8px;border-radius:10px}

/* detail */
.sectionTitle{margin:16px 0 8px 0;font-weight:800}
.params{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
.param{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid #e6eef6;border-radius:999px;padding:8px 12px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
.param b{font-weight:800;color:#055}
.method-chips{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.method-chips .chip{
  padding:8px 12px;border-radius:999px;background:#e8f8ff;border:1px solid #bfeaff;
  cursor:pointer;font-weight:700
}
.method-chips .chip.sel{background:#cbeeff}

.heroImg{width:100%;border-radius:16px;border:1px solid #e8eef5;box-shadow:var(--shadow)}
.ghost{background:#fff;border:1px solid #d9e8f5;border-radius:12px;padding:10px 14px}
.actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.button{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border:none;border-radius:12px;color:#00324d;background:linear-gradient(180deg,#f7fbff,#e6f5ff);font-weight:800;box-shadow:var(--shadow);cursor:pointer}
.button.primary{background:linear-gradient(180deg,#17a2ff,#0077ff);color:#fff}
.small{font-size:13px;color:var(--muted)}
</style>

<!-- ===== 画像オーバーライド設定（任意） =====
  下のマップに “魚名” や “魚名:釣り方” をキーにして
  任意ファイルパスを入れると、その画像に置き換わります。 -->
<script>
// 魚の写真の上書き（例）
window.FISH_IMG_OVERRIDE = {
  "シーバス": "img/comp-2446062.jpg",     // 例：独自の写真
  "アジ": "img/fish_aji_sample.jpg"       // 例：任意ファイル
};
// 仕掛け図の上書き（例）キーは「魚名:釣り方」
window.RIG_IMG_OVERRIDE = {
  "シーバス:ルアー": "img/rig_suzuki_lure.jpg",
  // "アジ:サビキ": "img/rig_aji_sabiki.png"
};

// キャッシュ切り替え用（数値を上げると即反映）
window.APP_VERSION = 37;
</script>
<script>
/* ===== ユーティリティ ===== */
const V = (k)=> `${k}?v=${window.APP_VERSION||1}`;
const toSlug = s => (s||'').trim()
  .replace(/[（(].*?[)）]/g,'-')   // 括弧内をハイフン
  .replace(/[^\p{L}\p{N}]+/gu,'-') // 非英数をハイフン
  .replace(/-+/g,'-').replace(/(^-|-$)/g,'');
const _baseName = s => (s||'').replace(/[（(].*?[)）]/g,'');

/* ===== 画像パス解決（オーバーライド対応） ===== */
function fishImg(f){
  const map = window.FISH_IMG_OVERRIDE || {};
  const keys = [f,_baseName(f),toSlug(f)];
  for(const k of keys){ if(map[k]) return V(map[k]); }
  return V(`img/fish-${toSlug(f)}.png`);
}
function rigImg(fish, method){
  const map = window.RIG_IMG_OVERRIDE || {};
  const keys = [
    `${fish}:${method}`,
    `${_baseName(fish)}:${method}`,
    `${toSlug(fish)}:${toSlug(method)}`
  ];
  for(const k of keys){
    if(map[k]){ const u = map[k]; return {specific:V(u),generic:V(u),placeholder:V(u)}; }
  }
  const m = toSlug(method)||"";
  return {
    specific:  V(`img/rig-${toSlug(fish)}-${m}.png`),
    generic:   V(`img/rig-${m}.png`),
    placeholder: "https://placehold.co/1200x600?text=Rig%20Illustration"
  };
}

/* ===== 釣り方→基本推奨ギア(簡易) ===== */
const GEAR_BY_METHOD = {
  "サビキ":[
    {label:"サビキ仕掛け一式", a:`https://www.amazon.co.jp/s?k=サビキ+仕掛け&tag=YOURAMAZONTAG-22`,
                                   r:`https://search.rakuten.co.jp/search/mall/サビキ%20仕掛け/`},
    {label:"コマセ(アミ姫など)", a:`https://www.amazon.co.jp/s?k=アミ姫&tag=YOURAMAZONTAG-22`,
                                   r:`https://search.rakuten.co.jp/search/mall/アミ姫/`}
  ],
  "ルアー":[
    {label:"ミノー/シンペン", a:`https://www.amazon.co.jp/s?k=シーバス+ミノー&tag=YOURAMAZONTAG-22`,
                                r:`https://search.rakuten.co.jp/search/mall/シーバス%20ミノー/`},
    {label:"メタル/バイブ", a:`https://www.amazon.co.jp/s?k=シーバス+バイブ+メタル&tag=YOURAMAZONTAG-22`,
                             r:`https://search.rakuten.co.jp/search/mall/シーバス%20バイブ/`}
  ],
  "ちょい投げ":[
    {label:"ちょい投げ仕掛け 5-8号", a:`https://www.amazon.co.jp/s?k=ちょい投げ+仕掛け&tag=YOURAMAZONTAG-22`,
                                     r:`https://search.rakuten.co.jp/search/mall/ちょい投げ%20仕掛け/`}
  ],
  "胴突き":[
    {label:"胴突き/ブラクリ", a:`https://www.amazon.co.jp/s?k=ブラクリ+仕掛け&tag=YOURAMAZONTAG-22`,
                               r:`https://search.rakuten.co.jp/search/mall/ブラクリ%20仕掛け/`}
  ],
  "ウキ":[
    {label:"棒ウキ/玉ウキ", a:`https://www.amazon.co.jp/s?k=釣り+棒ウキ&tag=YOURAMAZONTAG-22`,
                            r:`https://search.rakuten.co.jp/search/mall/玉ウキ/`}
  ]
};

/* ===== 魚の知識ベース（短縮版・必要に応じて追記してください） ===== */
const FISH_BOOK = {
  "アジ": { season:"初夏〜秋（越冬群も）", time:"朝夕／夜 常夜灯",
    shelf:"中層〜底寄り（潮目・明暗）",
    methods:["サビキ","遠投カゴ","ちょい投げ","ルアー"],
    bait:["アミエビ","オキアミ","青イソメ"],
    lures:["1–2gジグヘッド＋ワーム","7–20gメタル","フロート"],
    food:"刺身／なめろう／フライ／南蛮漬け"
  },
  "シーバス": { season:"通年（秋〜初冬最盛）", time:"夕・夜・朝マズメ",
    shelf:"表層〜中層（払い出し・ヨレ・ブレイク）",
    methods:["ルアー","泳がせ","ぶっこみ","ウキ"],   // 釣り方切替に使う
    bait:["活小魚/青イソメ"],
    lures:["ミノー120–140mm","シンペン/バイブ","30–40gジグ"],
    food:"洗い／刺身／ムニエル"
  },
  "ハゼ": { season:"夏〜晩秋", time:"日中〜夕（満ち引き前後）",
    shelf:"底（ミオ筋・障害物際）",
    methods:["ミャク釣り","ウキ","ちょい投げ","ハゼクラ"],
    bait:["アオイソメ","エビ身","ホタテ"],
    lures:["小型クランク","1g前後ジグヘッド"],
    food:"天ぷら／唐揚げ／甘露煮"
  },
  "カサゴ": { season:"通年（冬〜春が強い）", time:"夜（昼は穴撃ち）",
    shelf:"底（テトラ・根・壁際）",
    methods:["胴突き","ブラクリ","テキサス","穴釣り","ルアー"],
    bait:["青イソメ","サバ切身","オキアミ"],
    lures:["テキサス＋クロー/ホッグ","ジグヘッド"],
    food:"唐揚げ／味噌汁／煮付け"
  }
};

/* ===== 場所データ（東京都例・追記OK） ===== */
const PLACES = {
  "東京都":[
    { name:"若洲海浜公園（海釣り施設・人工磯）", area:"江東区若洲3丁目",
      map:"https://maps.google.com/?q=若洲海浜公園%20海釣り施設",
      fishes:["アジ","イシモチ","コノシロ","メバル","カサゴ","シーバス","ハゼ"],
      memo:"柵・売店・トイレあり。混雑多め／ライジャケ推奨。"
    },
    { name:"豊洲ぐるり公園（護岸）", area:"江東区豊洲6丁目ほか",
      map:"https://maps.google.com/?q=豊洲ぐるり公園",
      fishes:["ハゼ","シーバス","メバル","カサゴ","クロダイ","サヨリ"],
      memo:"禁止区画あり・撒き餌やロケット天秤禁止／歩行者最優先。"
    },
    { name:"砂町水辺公園（荒川）", area:"江東区東砂7〜8丁目",
      map:"https://maps.google.com/?q=砂町水辺公園",
      fishes:["ハゼ","シーバス","クロダイ","ボラ"],
      memo:"ゴロタで根掛かり・滑り注意／トイレ点在。"
    },
    { name:"大井ふ頭中央海浜公園（なぎさの森）", area:"品川区八潮4-2-1 周辺",
      map:"https://maps.google.com/?q=大井ふ頭中央海浜公園%20なぎさの森",
      fishes:["ハゼ","セイゴ","シーバス"],
      memo:"立入・釣り禁止区画あり／海上公園は投げ原則禁止（アンダー推奨）。"
    }
  ]
};

/* ===== 県リスト（上から順に表示） ===== */
const PREFS = Object.keys(PLACES);
                       </script>
</head>
<body>
<header>
  <div class="brand"><i></i>RigNavi<div class="badge">MVP</div></div>
</header>

<!-- ★ ハウス広告（上部固定領域） -->
<div class="banner" id="houseBanner">
  <a href="articles/sample-article.html" target="_blank" rel="noopener">
    <!-- 任意の画像を img/house-ad.jpg にアップして下さい -->
    <img src="img/house-ad.jpg" alt="おすすめ記事 / ハウス広告">
  </a>
  <div class="small">※画像が出ない場合は <code>img/house-ad.jpg</code> をアップロードしてください。</div>
</div>

<main>
  <div id="hello">起動中…</div>

  <div class="row">
    <section class="steps">
      <div class="card">
        <div class="row" style="gap:10px">
          <div class="stepCard"><b>1</b><h4>都道府県</h4></div>
          <div class="stepCard"><b>2</b><h4>釣り場</h4></div>
          <div class="stepCard"><b>3</b><h4>魚種</h4></div>
          <div class="stepCard"><b>4</b><h4>仕掛け/情報</h4></div>
        </div>

        <div class="sectionTitle">都道府県を選択</div>
        <div id="list-pref" class="tiles"></div>

        <div class="sectionTitle">釣り場を選択</div>
        <div id="list-place" class="tiles"></div>

        <div class="sectionTitle">魚種を選択</div>
        <div id="list-fish" class="tiles"></div>
      </div>
    </section>

    <section class="detail">
      <div class="card" id="detailCard">
        <div class="small">左で都道府県 → 釣り場 → 魚種の順に選んでください。</div>
      </div>
    </section>
  </div>
</main>

<script>
/* ====== UI(生成) ====== */
const el = id => document.getElementById(id);

function renderPrefs(){
  const box = el('list-pref'); box.innerHTML='';
  PREFS.forEach(p=>{
    const d=document.createElement('div');
    d.className='tile';
    d.innerHTML=`<h5>${p}</h5><div class="meta">釣り場：${PLACES[p].length}件</div>`;
    d.onclick=()=>{ state.pref=p; state.place=null; state.fish=null; renderPlaces(); renderFishes(); renderDetail(); };
    box.appendChild(d);
  });
}
function renderPlaces(){
  const box = el('list-place'); box.innerHTML='';
  if(!state.pref){ box.innerHTML='<div class="small">※ 先に都道府県を選択</div>'; return; }
  PLACES[state.pref].forEach(p=>{
    const d=document.createElement('div');
    d.className='tile';
    const fishTxt = (p.fishes||[]).slice(0,6).join('、');
    d.innerHTML = `
      <h5>${p.name}</h5>
      <div class="meta">${state.pref}／${p.area}</div>
      <div class="memo">一口メモ：${p.memo||"—"}</div>
      <div class="small" style="margin-top:6px"><a href="${p.map}" target="_blank">📍Googleマップ</a>・釣れる魚：${fishTxt||"—"}</div>
    `;
    d.onclick=()=>{ state.place=p; state.fish=null; renderFishes(); renderDetail(); };
    box.appendChild(d);
  });
}
function renderFishes(){
  const box = el('list-fish'); box.innerHTML='';
  if(!state.place){ box.innerHTML='<div class="small">※ 先に釣り場を選択</div>'; return; }
  const fishes = (state.place.fishes||[]).filter(f=>FISH_BOOK[f]);
  if(!fishes.length){ box.innerHTML='<div class="small">データ準備中</div>'; return; }
  fishes.forEach(f=>{
    const d=document.createElement('div');
    d.className='tile';
    d.innerHTML = `<h5>${f}</h5><div class="meta">${FISH_BOOK[f].season}</div>`;
    d.onclick=()=>{ state.fish=f; renderDetail(); };
    box.appendChild(d);
  });
}

function chip(name,sel){ return `<span class="chip ${sel?'sel':''}" data-m="${name}">${name}</span>`; }

function renderDetail(){
  const wrap = el('detailCard');
  if(!state.place || !state.fish){
    wrap.innerHTML = `<div class="small">※ 釣り場と魚種を選ぶと詳細が表示されます。</div>`;
    return;
  }
  const fish = state.fish, data = FISH_BOOK[fish];
  const imgFish = fishImg(fish);
  const methods = (data.methods||[]);
  if(!state.method || !methods.includes(state.method)){ state.method = methods[0]||""; }
  const rig = rigImg(fish, state.method);

  wrap.innerHTML = `
    <h3 style="margin-top:0">${fish}</h3>
    <div class="params">
      <div class="param"><b>季</b>${data.season||'—'}</div>
      <div class="param"><b>時</b>${data.time||'—'}</div>
      <div class="param"><b>棚</b>${data.shelf||'—'}</div>
    </div>

    <div class="sectionTitle">指定した魚画像</div>
    <img class="heroImg" src="${imgFish}" alt="${fish}">

    <div class="sectionTitle">釣り方</div>
    <div class="method-chips">
      ${methods.map(m=>chip(m, m===state.method)).join('')}
    </div>

    <div class="sectionTitle">仕掛けイラスト（${state.method||'—'}）</div>
    <img class="heroImg" src="${rig.specific}" onerror="this.src='${rig.generic}'; this.onerror=null;" alt="Rig">

    <div class="sectionTitle">オススメ部材</div>
    <div id="gearList"></div>

    <div class="sectionTitle">エサ／ルアー</div>
    <div class="small">エサ：${(data.bait||[]).join('、')||'—'}</div>
    <div class="small">ルアー：${(data.lures||[]).join('、')||'—'}</div>

    <div class="sectionTitle">狙い目の棚・時間帯</div>
    <div class="small">棚：${data.shelf||'—'}</div>
    <div class="small">時間：${data.time||'—'}</div>

    <div class="sectionTitle">食べ方メモ</div>
    <div class="small">${data.food||'—'}</div>

    <div class="actions">
      <a class="button ghost" href="${state.place.map}" target="_blank">📍 場所を地図で確認</a>
      <button class="button" id="shareBtn">友だちに共有</button>
    </div>
    <div class="small">釣り場：${state.place.name}（${state.place.area}）</div>
  `;

  // 釣り方チップのクリック
  wrap.querySelectorAll('.chip').forEach(c=>{
    c.onclick = ()=>{ state.method = c.dataset.m; renderDetail(); };
  });

  // ギア（釣り方に応じて）
  const gears = (GEAR_BY_METHOD[state.method]||[]);
  const gBox = wrap.querySelector('#gearList');
  gBox.innerHTML = gears.length
    ? gears.map(g=>`<div class="param" style="gap:12px"><b>${state.method}</b>${g.label}　
        <a href="${g.a}" target="_blank">Amazon</a>／<a href="${g.r}" target="_blank">楽天</a></div>`).join('')
    : '<div class="small">準備中</div>';

  // 共有
  const btn = wrap.querySelector('#shareBtn');
  btn.onclick = async ()=>{
    try{
      await liff.shareTargetPicker([{
        type:'text',
        text:`${state.place.name}で「${fish}」を${state.method}で狙う！\n地図: ${state.place.map}`
      }]);
    }catch(e){ /*閉じただけ*/ }
  };
}

/* ====== 状態 ====== */
const state = { pref:null, place:null, fish:null, method:null };

/* ====== LIFF Init ====== */
(async ()=>{
  try{
    await liff.init({ liffId: "2008257307-RwPLYWG1" });
    if(!liff.isLoggedIn()){ liff.login(); return; }
    const p = await liff.getProfile();
    el('hello').textContent = `ようこそ ${p.displayName} さん`;
  }catch(e){
    el('hello').textContent = "Webとして閲覧中（LIFF未ログイン）";
  }finally{
    renderPrefs(); renderPlaces(); renderFishes(); renderDetail();
  }
})();
</script>
</body>
</html>
