<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RigNavi MVP</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<style>
  :root{
    --bg:#12334a;          /* ã™ã“ã—æ˜ã‚‹ã‚ã®æµ·è‰² */
    --bg-grad:#0f2f45;
    --panel:#183d57;
    --chip:#1e4967;
    --accent:#2ed0ff;      /* æ°´è‰²ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
    --text:#eef7ff;
    --muted:#b6d3e6;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--text);
    background:linear-gradient(180deg,var(--bg),var(--bg-grad));
    min-height:100vh;
  }
  header{
    display:flex; align-items:center; justify-content:space-between;
    padding:16px 18px; border-bottom:1px solid rgba(255,255,255,.08);
  }
  .brand{display:flex; gap:8px; align-items:center; font-weight:700; font-size:20px}
  .badge{background:#2b6d86; padding:6px 10px; border-radius:999px; font-size:12px}
  main{padding:18px; max-width:900px; margin:0 auto}
  #hello{margin:4px 0 12px; color:var(--muted)}
  .steps{display:flex; gap:12px; flex-wrap:wrap; margin-bottom:14px}
  .step{position:relative; background:var(--chip); color:#cfe8f6; border-radius:16px; padding:14px 16px; width:120px; text-align:center; opacity:.7}
  .step.on{opacity:1; outline:1px solid rgba(255,255,255,.15)}
  .step::before{content:attr(data-no); font-weight:700; position:absolute; left:10px; top:10px; background:#0e2b3e; color:#a8d8ef; width:22px; height:22px; border-radius:50%; display:grid; place-items:center; font-size:12px}
  .row{display:flex; gap:10px; flex-wrap:wrap}
  .card{
    background:var(--panel); border:1px solid rgba(255,255,255,.08);
    border-radius:14px; padding:16px; margin:12px 0;
    box-shadow:0 10px 20px rgba(0,0,0,.15);
  }
  h1,h2,h3{margin:.2em 0 .4em}
  h1{font-size:28px}
  h3{font-size:18px}
  .muted{color:var(--muted)}
  .chips{display:flex; flex-wrap:wrap; gap:10px; margin-top:8px}
  .chip,button{
    appearance:none; border:none; cursor:pointer; font-size:16px; border-radius:12px;
    padding:12px 14px;
  }
  .chip{background:var(--chip); color:#e7f6ff}
  button{background:var(--accent); color:#002333; font-weight:700}
  button.sub{background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.2)}
  a{color:#aee8ff; text-decoration:underline}
  nav.top{
    display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;
  }
  #back{visibility:hidden}
  ul.items{padding-left:18px; margin:8px 0}
  ul.items li{margin:6px 0}
</style>
</head>
<body>
  <header>
    <div class="brand">ğŸ£ RigNavi</div>
    <div class="badge">MVP</div>
  </header>

  <main>
    <div id="hello">èµ·å‹•ä¸­â€¦</div>

    <nav class="top">
      <div class="steps" id="steps"></div>
      <button id="back" class="sub" onclick="goBack()">æˆ»ã‚‹</button>
    </nav>

    <div id="app"></div>
  </main>

<script>
/* ===== è¨­å®š ===== */
const LIFF_ID = "2008257307-RwPLYWG1";
const VERSION = "6";

/* ===== ãƒ‡ãƒ¼ã‚¿ï¼ˆã„ãŸã ã„ãŸ10ã‚¹ãƒãƒƒãƒˆï¼‰ ===== */
const DB = [
  {
    id:"wakasu",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è‹¥æ´²æµ·æµœå…¬åœ’ï¼ˆæµ·é‡£ã‚Šæ–½è¨­ãƒ»äººå·¥ç£¯ï¼‰",
    address:"æ±äº¬éƒ½æ±Ÿæ±åŒºè‹¥æ´²3ä¸ç›®",
    map:"https://maps.google.com/?q=%E8%8B%A5%E6%B4%B2%E6%B5%B7%E6%BF%B1%E5%85%AC%E5%9C%92%20%E6%B5%B7%E9%87%A3%E3%82%8A%E6%96%BD%E8%A8%AD",
    types:["å ¤é˜²","äººå·¥ç£¯","è­·å²¸"],
    fishes:["ã‚¢ã‚¸","ã‚¤ã‚·ãƒ¢ãƒ","ã‚³ãƒã‚·ãƒ­","ãƒ¡ãƒãƒ«","ã‚«ã‚µã‚´","ã‚·ãƒ¼ãƒã‚¹"],
    methods:["ã‚µãƒ“ã‚­","ã¡ã‚‡ã„æŠ•ã’","ãƒ«ã‚¢ãƒ¼","ç©´é‡£ã‚Š"],
    shelf:"å ¤é˜²ã®è§’ãƒ»æ˜æš—ã€äººå·¥ç£¯ã®çŸ³é–“ï¼ˆç©´æ‰“ã¡ï¼‰ã€è¡¨å±¤ã€œä¸­å±¤å›éŠåå¿œ",
    notes:"é§è»Šå ´ãƒ»å£²åº—ãƒ»ãƒˆã‚¤ãƒ¬ã‚ã‚Šã€‚æ··é›‘å¤šã‚ã€‚å®‰å…¨æŸµã‚ã‚Šã€‚",
    items:[
      {label:"ã‚µãƒ“ã‚­ä»•æ›ã‘ä¸€å¼", url:"https://www.amazon.co.jp/s?k=%E3%82%B5%E3%83%93%E3%82%AD+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"},
      {label:"ã¡ã‚‡ã„æŠ•ã’ã‚ªãƒ¢ãƒª5ã€œ10å·", url:"https://www.amazon.co.jp/s?k=%E3%83%8A%E3%82%B9%E5%9E%8B%E3%82%AA%E3%83%A2%E3%83%AA+5%E5%8F%B7&tag=YOURID-22"}
    ]
  },
  {
    id:"toyosu-gururi",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è±Šæ´²ãã‚‹ã‚Šå…¬åœ’ï¼ˆè­·å²¸ï¼‰",
    address:"æ±äº¬éƒ½æ±Ÿæ±åŒºè±Šæ´²6ä¸ç›®ã»ã‹",
    map:"https://maps.google.com/?q=%E8%B1%8A%E6%B4%B2%E3%81%90%E3%82%8B%E3%82%8A%E5%85%AC%E5%9C%92",
    types:["è­·å²¸"],
    fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ãƒ¡ãƒãƒ«","ã‚«ã‚µã‚´","ã‚¯ãƒ­ãƒ€ã‚¤","ã‚µãƒ¨ãƒª"],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ãƒ˜ãƒãƒ»è½ã¨ã—è¾¼ã¿","ãƒ«ã‚¢ãƒ¼"],
    shelf:"æŸµéš›ã®ã‚­ãƒ¯ã€æ©‹ãƒ»å¸¸å¤œç¯ã®æ˜æš—ã€è¶³å…ƒã®ã‚«ã‚±ä¸ŠãŒã‚Š",
    notes:"æ’’ãé¤Œãƒ»ãƒˆãƒªãƒƒã‚¯ã‚µãƒ“ã‚­ãƒ»ãƒ­ã‚±ãƒƒãƒˆå¤©ç§¤ç¦æ­¢ã€‚æ­©è¡Œè€…æœ€å„ªå…ˆã€‚é‡£ã‚Šç¦æ­¢åŒºç”»ã‚ã‚Šã€‚",
    items:[
      {label:"ãƒ˜ãƒç”¨ä»•æ›ã‘ï¼ˆç‰ã‚¦ã‚­/ã‚·ãƒ³ã‚«ãƒ¼ï¼‰", url:"https://www.amazon.co.jp/s?k=%E3%83%98%E3%83%81+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"},
      {label:"å°å‹ãƒã‚¤ãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³10ã€œ20g", url:"https://www.amazon.co.jp/s?k=%E3%83%90%E3%82%A4%E3%83%96%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3+%E3%83%AB%E3%82%A2%E3%83%BC&tag=YOURID-22"}
    ]
  },
  {
    id:"sunamachi-mizube",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"ç ‚ç”ºæ°´è¾ºå…¬åœ’ï¼ˆè’å·ãƒ»æ±Ÿæ±åŒºå´ï¼‰",
    address:"æ±äº¬éƒ½æ±Ÿæ±åŒºæ±ç ‚7ã€œ8ä¸ç›®",
    map:"https://maps.google.com/?q=%E7%A0%82%E7%94%BA%E6%B0%B4%E8%BE%BA%E5%85%AC%E5%9C%92",
    types:["è­·å²¸","ã‚´ãƒ­ã‚¿å¸¯","æ²³å£å¯„ã‚Š"],
    fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ã‚¯ãƒ­ãƒ€ã‚¤","ãƒœãƒ©"],
    methods:["ã¡ã‚‡ã„æŠ•ã’","ã‚¦ã‚­","ãƒ«ã‚¢ãƒ¼"],
    shelf:"ã‚´ãƒ­ã‚¿ã®ã‚­ãƒ¯ã€œæ•°må…ˆã€æ©‹è„šã®ãƒ¨ãƒ¬ã€ä¸‹ã’å§‹ã‚ã®æµã‚Œ",
    notes:"å—ç ‚ç”ºé§…ã‹ã‚‰å¾’æ­©åœã€‚è¶³å…ƒæ ¹æ›ã‹ã‚Šæ³¨æ„ã€‚ãƒˆã‚¤ãƒ¬ç‚¹åœ¨ã€‚",
    items:[
      {label:"ãƒã‚¼ç”¨ãƒŸãƒ£ã‚¯é‡£ã‚Šä»•æ›ã‘", url:"https://www.amazon.co.jp/s?k=%E3%83%8F%E3%82%BC+%E4%BB%95%E6%8E%9B%E3%81%91+%E3%83%9F%E3%83%A3%E3%82%AF%E9%87%A3%E3%82%8A&tag=YOURID-22"},
      {label:"ã‚·ãƒ¼ãƒã‚¹ç”¨ãƒŸãƒãƒ¼9ã€œ12cm", url:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%9F%E3%83%8E%E3%83%BC&tag=YOURID-22"}
    ]
  },
  {
    id:"kyunakagawa",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº/æ±Ÿæˆ¸å·åŒº",
    name:"æ—§ä¸­å·ï¼ˆæ±å¤§å³¶é§…ã€œä¸­å·å¤§æ©‹ï¼‰",
    address:"æ±å¤§å³¶é§…å‘¨è¾ºã€œä¸­å·å¤§æ©‹æ²¿ã„",
    map:"https://maps.google.com/?q=%E6%97%A7%E4%B8%AD%E5%B7%9D%20%E6%9D%B1%E5%A4%A7%E5%B3%B6",
    types:["æ²³å·","ã‚´ãƒ­ã‚¿è­·å²¸","æ©‹è„š"],
    fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´"],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","è»½é‡ãƒ«ã‚¢ãƒ¼"],
    shelf:"æ©‹ã®é™°ã€ã‚´ãƒ­ã‚¿å¸¯ã®çŸ³é–“ã€é§…ç›´ä¸‹ã€œä¸­å·å¤§æ©‹ãŒå®‰å®š",
    notes:"å¤§å³¶å°æ¾å·å…¬åœ’é§è»Šå ´ã‚’èµ·ç‚¹ã«ä¾¿åˆ©ã€‚ç››å¤ã€œåˆç§‹ã®ãƒ‡ã‚¤ãŒå¼·ã„ã€‚",
    items:[
      {label:"ã®ã¹ç«¿2â€“3mï¼‹å°é‡ï¼ˆãƒã‚¼ï¼‰", url:"https://www.amazon.co.jp/s?k=%E3%83%8F%E3%82%BC+%E3%81%AE%E3%81%B9%E7%AB%BF+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"},
      {label:"3ã€œ7gã‚¯ãƒ©ãƒ³ã‚¯ï¼ã‚¹ãƒ—ãƒ¼ãƒ³", url:"https://www.amazon.co.jp/s?k=%E3%83%8F%E3%82%BC%E3%82%AF%E3%83%A9%E3%83%B3%E3%82%AF&tag=YOURID-22"}
    ]
  },
  {
    id:"arakawa-estuary",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"è’å·æ²³å£ï¼ˆæ¸…ç ‚å¤§æ©‹ã€œæ–°ç ‚æ°´è¾ºå…¬åœ’ï¼‰",
    address:"æ¸…ç ‚å¤§æ©‹ã€œæ–°ç ‚æ°´è¾ºå…¬åœ’æ²¿ã„",
    map:"https://maps.google.com/?q=%E6%B8%85%E7%A0%82%E5%A4%A7%E6%A9%8B%20%E6%96%B0%E7%A0%82%E6%B0%B4%E8%BE%BA%E5%85%AC%E5%9C%92",
    types:["æ²³å£","ã‚´ãƒ­ã‚¿è­·å²¸"],
    fishes:["ã‚·ãƒ¼ãƒã‚¹","ã‚¯ãƒ­ãƒ€ã‚¤","ãƒã‚¼"],
    methods:["ãƒ«ã‚¢ãƒ¼","ã¶ã£ã“ã¿","ãƒ˜ãƒ"],
    shelf:"ã‚´ãƒ­ã‚¿ã®éš›ã€ãƒ¨ãƒ¬ã€æ½®ã®å‹•ãå‡ºã—",
    notes:"æœ€å¯„ã‚Šãƒˆã‚¤ãƒ¬ã¯æ–°ç ‚æ°´è¾ºå…¬åœ’ã€‚è¶³å…ƒæ»‘ã‚Šæ³¨æ„ã€‚",
    items:[
      {label:"14ã€œ20gãƒã‚¤ãƒ–ãƒ»ãƒ–ãƒ¬ãƒ¼ãƒ‰", url:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%90%E3%82%A4%E3%83%96%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3&tag=YOURID-22"},
      {label:"ãƒãƒŒè½ã¨ã—è¾¼ã¿ä¸€å¼", url:"https://www.amazon.co.jp/s?k=%E8%90%BD%E3%81%A8%E3%81%97%E8%BE%BC%E3%81%BF+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"}
    ]
  },
  {
    id:"hirai-undo",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæˆ¸å·åŒº",
    name:"å¹³äº•é‹å‹•å…¬åœ’ï¼ˆè’å·Ã—æ—§ä¸­å·åˆæµåŸŸï¼‰",
    address:"æ±äº¬éƒ½æ±Ÿæˆ¸å·åŒºå¹³äº• è’å·ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å†…",
    map:"https://maps.google.com/?q=%E5%B9%B3%E4%BA%95%E9%81%8B%E5%8B%95%E5%85%AC%E5%9C%92%20%E8%8D%92%E5%B7%9D",
    types:["æ²³å·è­·å²¸","æ©‹è„š"],
    fishes:["ã‚·ãƒ¼ãƒã‚¹","ãƒã‚¼","ã‚³ã‚¤","ã‚¦ãƒŠã‚®"],
    methods:["ãƒ«ã‚¢ãƒ¼","ã¶ã£ã“ã¿","ã‚¦ã‚­"],
    shelf:"æ©‹è„šã®æ˜æš—ã€æ’æ°´æ©Ÿå ´ã®åè»¢æµã€è¶³å…ƒã®é§†ã‘ä¸ŠãŒã‚Š",
    notes:"æ²³å·æ•·é§è»Šå ´ã¯åœŸæ—¥ç¥ã®ã¿é–‹æ”¾ã€‚ãƒˆã‚¤ãƒ¬ã¯ç°¡æ˜“å‹ä¸­å¿ƒã€‚",
    items:[
      {label:"9ã€œ12cmã‚·ãƒ³ã‚­ãƒ³ã‚°ãƒŸãƒãƒ¼", url:"https://www.amazon.co.jp/s?k=%E3%82%B7%E3%83%BC%E3%83%90%E3%82%B9+%E3%83%9F%E3%83%8E%E3%83%BC+9cm&tag=YOURID-22"},
      {label:"ã¶ã£ã“ã¿ä»•æ›ã‘ï¼ˆã‚¦ãƒŠã‚®ï¼‰", url:"https://www.amazon.co.jp/s?k=%E3%82%A6%E3%83%8A%E3%82%AE+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"}
    ]
  },
  {
    id:"tamagawa-daishi",
    pref:"æ±äº¬éƒ½", city:"å¤§ç”°åŒº",
    name:"å¤šæ‘©å·ãƒ»å¤§å¸«æ©‹ã€œç¾½ç”°ï¼ˆæ±äº¬éƒ½å´ï¼‰",
    address:"å¤§å¸«æ©‹å‘¨è¾ºã€œç¾½ç”°ç©ºæ¸¯å¯„ã‚Šæ²³å£",
    map:"https://maps.google.com/?q=%E5%A4%9A%E6%91%A9%E5%B7%9D%20%E5%A4%A7%E5%B8%AB%E6%A9%8B",
    types:["æ²³å£","è­·å²¸"],
    fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´","ãƒã‚´ãƒ"],
    methods:["ã¡ã‚‡ã„æŠ•ã’","ãƒ«ã‚¢ãƒ¼"],
    shelf:"æ©‹è„šã®ãƒ¨ãƒ¬ã€æ½®ä½å¤‰åŒ–ã§å‹•ãã‚«ã‚±ä¸ŠãŒã‚Š",
    notes:"æ¿ã‚Šã®å…¥ã£ãŸå¾Œã«ã‚»ã‚¤ã‚´å¥½èª¿ã€‚æº€å¹²å·®å¤§ã€‚",
    items:[
      {label:"5ã€œ8å·ã¡ã‚‡ã„æŠ•ã’ä»•æ›ã‘", url:"https://www.amazon.co.jp/s?k=%E3%81%A1%E3%82%87%E3%81%84%E6%8A%95%E3%81%92+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"},
      {label:"20ã€œ30gãƒ•ãƒ©ãƒƒãƒˆç”¨ã‚¸ã‚°ãƒ˜ãƒƒãƒ‰ï¼‹ãƒ¯ãƒ¼ãƒ ", url:"https://www.amazon.co.jp/s?k=%E3%83%9E%E3%82%B4%E3%83%81+%E3%83%AF%E3%83%BC%E3%83%A0&tag=YOURID-22"}
    ]
  },
  {
    id:"ooi-nagisa",
    pref:"æ±äº¬éƒ½", city:"å“å·åŒº/å¤§ç”°åŒº",
    name:"å¤§äº•ãµé ­ä¸­å¤®æµ·æµœå…¬åœ’ï¼ˆãªãã•ã®æ£®ï¼‰",
    address:"æ±äº¬éƒ½å“å·åŒºå…«æ½®4-2-1 å‘¨è¾º",
    map:"https://maps.google.com/?q=%E5%A4%A7%E4%BA%95%E3%81%B5%E9%A0%AD%E4%B8%AD%E5%A4%AE%E6%B5%B7%E6%B5%9C%E5%85%AC%E5%9C%92%20%E3%81%AA%E3%81%8E%E3%81%95%E3%81%AE%E6%A3%AE",
    types:["é‹æ²³æ²¿ã„ç£¯çŠ¶è­·å²¸","äººå£æµœ"],
    fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´"],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­"],
    shelf:"ã‚´ãƒ­ã‚¿ã®ç©´ãƒ»å²©é™°ã®è¶…è¿‘è·é›¢",
    notes:"ç«‹å…¥ãƒ»é‡£ã‚Šç¦æ­¢åŒºç”»ã‚ã‚Šã€‚æµ·ä¸Šå…¬åœ’ã¯å±é™ºãªæŠ•ã’é‡£ã‚Šç¦æ­¢ã€‚",
    items:[
      {label:"ãƒã‚¼ç”¨å°éˆï¼†ã‚¬ãƒ³ç‰", url:"https://www.amazon.co.jp/s?k=%E3%83%8F%E3%82%BC+%E9%87%9D+%E3%82%AC%E3%83%B3%E7%8E%89&tag=YOURID-22"},
      {label:"2ã€œ3mçŸ­ç«¿ï¼ˆå»¶ã¹ï¼å°ç¶™ï¼‰", url:"https://www.amazon.co.jp/s?k=%E5%BB%B6%E3%81%B9%E7%AB%BF+2.7m&tag=YOURID-22"}
    ]
  },
  {
    id:"yokojikken",
    pref:"æ±äº¬éƒ½", city:"æ±Ÿæ±åŒº",
    name:"æ¨ªåé–“å·è¦ªæ°´å…¬åœ’ï¼ˆé‹æ²³ï¼‰",
    address:"æ±äº¬éƒ½æ±Ÿæ±åŒº å¤§å³¶ãƒ»åŒ—ç ‚å‘¨è¾º",
    map:"https://maps.google.com/?q=%E6%A8%AA%E5%8D%81%E9%96%93%E5%B7%9D%E8%A6%AA%E6%B0%B4%E5%85%AC%E5%9C%92",
    types:["é‹æ²³","è¦ªæ°´å…¬åœ’"],
    fishes:["ãƒã‚¼","ãƒ†ãƒŠã‚¬ã‚¨ãƒ“"],
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","å°ã‚¦ã‚­"],
    shelf:"è¶³å…ƒéš›ã€æ©‹å‘¨ã‚Šã®é™°",
    notes:"ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘ã€‚å¤å ´ã®æ‰‹é•·ç‹™ã„ã«â—ã€‚",
    items:[
      {label:"ãƒ†ãƒŠã‚¬ã‚¨ãƒ“ä»•æ›ã‘ï¼ˆå°éˆï¼‰", url:"https://www.amazon.co.jp/s?k=%E3%83%86%E3%83%8A%E3%82%AC%E3%82%A8%E3%83%93+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"},
      {label:"ç‰ã‚¦ã‚­0.5ã€œ1å·", url:"https://www.amazon.co.jp/s?k=%E5%B0%8F%E5%9E%8B+%E7%8E%89%E3%82%A6%E3%82%AD&tag=YOURID-22"}
    ]
  },
  {
    id:"mizumoto",
    pref:"æ±äº¬éƒ½", city:"è‘›é£¾åŒº",
    name:"æ°´å…ƒå…¬åœ’ï¼ˆæ·¡æ°´ï¼šæ± ãƒ»æ°´è·¯ï¼‰",
    address:"æ±äº¬éƒ½è‘›é£¾åŒº æ°´å…ƒå…¬åœ’",
    map:"https://maps.google.com/?q=%E6%B0%B4%E5%85%83%E5%85%AC%E5%9C%92",
    types:["æ± ãƒ»æ°´è·¯"],
    fishes:["ã‚³ã‚¤","ãƒ•ãƒŠ","ãƒ˜ãƒ©ãƒ–ãƒŠ","ãƒ†ãƒŠã‚¬ã‚¨ãƒ“"],
    methods:["ã‚¦ã‚­ï¼ˆã‚¨ã‚µé‡£ã‚Šï¼‰"],
    shelf:"åœ’å†…ã®æ°´è·¯ãƒ»ãƒ¯ãƒ³ãƒ‰ã®ã‚«ã‚±ä¸ŠãŒã‚Šã€æ­ã¾ã‚ã‚Š",
    notes:"ç„¡æ–™ï¼ˆä¸€éƒ¨æ–½è¨­é™¤ãï¼‰ã€‚é§è»Šå ´ãƒ»ãƒˆã‚¤ãƒ¬å¤šæ•°ã€‚",
    items:[
      {label:"ãƒ˜ãƒ©ãƒ»ãƒ•ãƒŠç”¨ã‚¦ã‚­ä»•æ›ã‘", url:"https://www.amazon.co.jp/s?k=%E3%83%98%E3%83%A9%E3%83%96%E3%83%8A+%E4%BB%95%E6%8E%9B%E3%81%91&tag=YOURID-22"},
      {label:"ã‚³ãƒ¼ãƒ³ï¼ç·´ã‚Šé¤Œ å„ç¨®", url:"https://www.amazon.co.jp/s?k=%E7%B7%B4%E3%82%8A%E9%A4%8C&tag=YOURID-22"}
    ]
  }
];

/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
const PREFS = [...new Set(DB.map(p=>p.pref))];
const getPlace = ()=> DB.find(p=>p.id===state.placeId);
const openWin = url => liff.isInClient() ? liff.openWindow({url, external:true}) : window.open(url,'_blank');
window.openMap = pid => openWin(DB.find(p=>p.id===pid).map);
window.ext = url => openWin(url);

/* ===== çŠ¶æ…‹ç®¡ç† ===== */
const state = { step:0, pref:null, placeId:null, type:null, fish:null, method:null };

/* ===== ç”»é¢æç”» ===== */
function render(){
  const titles = ["éƒ½é“åºœçœŒ","é‡£ã‚Šå ´æ‰€","é‡£ã‚Šãƒã‚¤ãƒ³ãƒˆ","é­šç¨®","é‡£ã‚Šæ–¹","çµæœ"];
  document.getElementById('steps').innerHTML =
    titles.map((t,i)=>`<div class="step ${i<=state.step?'on':''}" data-no="${i+1}"><div>${t}</div></div>`).join('');

  const app = document.getElementById('app');
  const backBtn = document.getElementById('back');
  backBtn.style.visibility = state.step>0 ? 'visible':'hidden';

  if(state.step===0){
    app.innerHTML = PREFS.map(p=>{
      const n = DB.filter(d=>d.pref===p).length;
      return `<div class="card"><h3>${p}</h3><p class="muted">${n} ã‚¹ãƒãƒƒãƒˆ</p>
              <div class="row"><button onclick="selPref('${p}')">ã“ã®éƒ½é“åºœçœŒã‚’é¸ã¶</button></div></div>`;
    }).join('');
    return;
  }

  if(state.step===1){
    const list = DB.filter(d=>!state.pref || d.pref===state.pref);
    app.innerHTML = list.map(d=>`
      <div class="card">
        <h3>${d.name}</h3>
        <p class="muted">${d.pref} ${d.city||''} / ${d.address||''}</p>
        <div class="row">
          <button class="sub" onclick="openMap('${d.id}')">åœ°å›³</button>
          <button onclick="selPlace('${d.id}')">ã“ã“ã‚’é¸ã¶</button>
        </div>
      </div>`).join('');
    return;
  }

  if(state.step===2){
    const p = getPlace();
    app.innerHTML = `
      <div class="card">
        <h3>${p.name}ï½œé‡£ã‚Šãƒã‚¤ãƒ³ãƒˆ</h3>
        <div class="chips">${p.types.map(t=>`<button class="chip" onclick="selType('${t}')">${t}</button>`).join('')}</div>
      </div>`;
    return;
  }

  if(state.step===3){
    const p = getPlace();
    app.innerHTML = `
      <div class="card">
        <h3>${p.name}ï½œé­šç¨®</h3>
        <div class="chips">${p.fishes.map(f=>`<button class="chip" onclick="selFish('${f}')">${f}</button>`).join('')}</div>
      </div>`;
    return;
  }

  if(state.step===4){
    const p = getPlace();
    app.innerHTML = `
      <div class="card">
        <h3>${p.name}ï½œé‡£ã‚Šæ–¹</h3>
        <div class="chips">${p.methods.map(m=>`<button class="chip" onclick="selMethod('${m}')">${m}</button>`).join('')}</div>
      </div>`;
    return;
  }

  if(state.step===5){
    const p = getPlace();
    app.innerHTML = `
      <div class="card">
        <h3>${p.name}</h3>
        <p class="muted">${p.pref} ${p.city||''} / ${p.address||''}</p>
        <p>é¸æŠï¼š<b>${state.type}</b> Ã— <b>${state.fish}</b> Ã— <b>${state.method}</b></p>
        <p><b>æ£šãƒ»ç‹™ã„ç›®ï¼š</b>${p.shelf}</p>
        <p class="muted">${p.notes||''}</p>
        <h4>ãŠã™ã™ã‚éƒ¨æ</h4>
        <ul class="items">
          ${p.items.map(i=>`<li><a href="#" onclick="ext('${i.url}')">${i.label}</a></li>`).join('')}
        </ul>
        <div class="row">
          <button class="sub" onclick="openMap('${p.id}')">åœ°å›³</button>
          <button onclick="share()">å‹ã ã¡ã«å…±æœ‰</button>
        </div>
      </div>`;
    return;
  }
}

/* ===== é¸æŠãƒãƒ³ãƒ‰ãƒ© ===== */
function selPref(p){ state.pref=p; state.step=1; render(); }
function selPlace(id){ state.placeId=id; state.step=2; render(); }
function selType(t){ state.type=t; state.step=3; render(); }
function selFish(f){ state.fish=f; state.step=4; render(); }
function selMethod(m){ state.method=m; state.step=5; render(); }

function goBack(){
  if(state.step<=0) return;
  if(state.step===1){ state.pref=null; }
  if(state.step===2){ state.placeId=null; }
  if(state.step===3){ state.type=null; }
  if(state.step===4){ state.fish=null; }
  if(state.step===5){ state.method=null; }
  state.step--; render();
}

/* ===== LIFF èµ·å‹• ===== */
(async()=>{
  await liff.init({ liffId: LIFF_ID });

  if (liff.isInClient()) {
    if (!liff.isLoggedIn()) { liff.login({ prompt:"consent" }); return; }
    try {
      const p = await liff.getProfile();
      document.getElementById('hello').textContent = `ã‚ˆã†ã“ã ${p.displayName} ã•ã‚“`;
    } catch { document.getElementById('hello').textContent = 'ã‚ˆã†ã“ãï¼'; }
  } else {
    document.getElementById('hello').textContent = 'ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­';
  }

  render();
})();

async function share(){
  if(!liff.isInClient()){ alert('å…±æœ‰ã¯LINEã‚¢ãƒ—ãƒªå†…ã§é–‹ã„ã¦ãã ã•ã„'); return; }
  const p = getPlace();
  const msg = `${p.name}\n${state.type} Ã— ${state.fish} Ã— ${state.method}\nç‹™ã„ç›®: ${p.shelf}\nåœ°å›³: ${p.map}`;
  await liff.shareTargetPicker([{ type:'text', text: msg }]);
}
</script>
</body>
 </html>
