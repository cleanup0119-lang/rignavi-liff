<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RigNavi MVP</title>
<link rel="icon" href="data:,">

<!-- LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<!-- ===== Theme / Layout ===== -->
<style>
:root{
  --bg:#eef5ff;          /* æ˜ã‚‹ã„æµ·è‰²ãƒ™ãƒ¼ã‚¹ */
  --card:#ffffff;
  --ink:#11223a;
  --muted:#5b6b81;
  --accent:#17a2ff;
  --accent-2:#66d1ff;
  --chip:#e8f5ff;
  --shadow:0 8px 26px rgba(17,34,58,.12);
  --radius:16px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN","Hiragino Kaku Gothic ProN","ãƒ¡ã‚¤ãƒªã‚ª",Meiryo,"Noto Sans JP","Yu Gothic UI","æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“",YuGothic,"MS PGothic",sans-serif}
a{color:#0b7cc4;text-decoration:none}
header{
  position:sticky;top:0;z-index:30;
  backdrop-filter:saturate(1.2) blur(10px);
  background:linear-gradient(180deg,rgba(255,255,255,.85),rgba(255,255,255,.75));
  border-bottom:1px solid rgba(0,0,0,.05);
}
.brand{padding:14px 18px;font-weight:800;display:flex;gap:8px;align-items:center}
.brand i{width:22px;height:22px;border-radius:6px;background:linear-gradient(135deg,#23b0ff,#005bff);display:inline-block}
.badge{margin-left:auto;margin-right:14px;padding:4px 10px;border-radius:999px;font-weight:700;background:#dff2ff;color:#0b6aa4}

.banner{
  margin:14px auto;max-width:1100px;padding:0 14px;
}
.banner a{
  display:block;border-radius:18px;overflow:hidden;border:1px solid rgba(0,0,0,.05);
  box-shadow:var(--shadow);background:#fff;
}
.banner img{display:block;width:100%;height:auto}

main{max-width:1100px;margin:8px auto;padding: 0 14px 28px}
#hello{margin:10px 0 16px;color:var(--muted)}

.row{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
.steps,.detail{flex:1 1 360px}

.card{
  background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);
  border:1px solid rgba(0,0,0,.06);padding:16px
}

/* Step cards */
.stepCard{
  display:flex;align-items:center;gap:10px;
  padding:16px;border-radius:14px;background:#f6fbff;border:1px solid #e6f3ff;
  min-width:150px;box-shadow:0 4px 16px rgba(23,162,255,.08)
}
.stepCard b{background:var(--accent);color:#fff;border-radius:10px;padding:2px 8px}
.stepCard h4{margin:0;font-size:18px}

/* tiles */
.tiles{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:12px;margin-top:12px}
.tile{
  border-radius:14px;border:1px solid rgba(0,0,0,.06);background:#fff;padding:14px;box-shadow:var(--shadow);cursor:pointer
}
.tile h5{margin:0 0 6px 0;font-size:15px}
.meta{color:var(--muted);font-size:12px}
.memo{margin-top:6px;font-size:12px;color:#224c6f;background:#e8f5ff;border:1px dashed #bfe7ff;padding:8px;border-radius:10px}

/* detail */
.sectionTitle{margin:16px 0 8px 0;font-weight:800}
.params{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
.param{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid #e6eef6;border-radius:999px;padding:8px 12px;box-shadow:0 2px 6px rgba(0,0,0,.04)}
.param b{font-weight:800;color:#055}
.method-chips{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.method-chips .chip{
  padding:8px 12px;border-radius:999px;background:#e8f8ff;border:1px solid #bfeaff;
  cursor:pointer;font-weight:700
}
.method-chips .chip.sel{background:#cbeeff}

.heroImg{width:100%;border-radius:16px;border:1px solid #e8eef5;box-shadow:var(--shadow)}
.ghost{background:#fff;border:1px solid #d9e8f5;border-radius:12px;padding:10px 14px}
.actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
.button{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border:none;border-radius:12px;color:#00324d;background:linear-gradient(180deg,#f7fbff,#e6f5ff);font-weight:800;box-shadow:var(--shadow);cursor:pointer}
.button.primary{background:linear-gradient(180deg,#17a2ff,#0077ff);color:#fff}
.small{font-size:13px;color:var(--muted)}
</style>

<!-- ===== ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰è¨­å®šï¼ˆä»»æ„ï¼‰ =====
  ä¸‹ã®ãƒãƒƒãƒ—ã« â€œé­šåâ€ ã‚„ â€œé­šå:é‡£ã‚Šæ–¹â€ ã‚’ã‚­ãƒ¼ã«ã—ã¦
  ä»»æ„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å…¥ã‚Œã‚‹ã¨ã€ãã®ç”»åƒã«ç½®ãæ›ã‚ã‚Šã¾ã™ã€‚ -->
<script>
// é­šã®å†™çœŸã®ä¸Šæ›¸ãï¼ˆä¾‹ï¼‰
window.FISH_IMG_OVERRIDE = {
  "ã‚·ãƒ¼ãƒã‚¹": "img/comp-2446062.jpg",     // ä¾‹ï¼šç‹¬è‡ªã®å†™çœŸ
  "ã‚¢ã‚¸": "img/fish_aji_sample.jpg"       // ä¾‹ï¼šä»»æ„ãƒ•ã‚¡ã‚¤ãƒ«
};
// ä»•æ›ã‘å›³ã®ä¸Šæ›¸ãï¼ˆä¾‹ï¼‰ã‚­ãƒ¼ã¯ã€Œé­šå:é‡£ã‚Šæ–¹ã€
window.RIG_IMG_OVERRIDE = {
  "ã‚·ãƒ¼ãƒã‚¹:ãƒ«ã‚¢ãƒ¼": "img/rig_suzuki_lure.jpg",
  // "ã‚¢ã‚¸:ã‚µãƒ“ã‚­": "img/rig_aji_sabiki.png"
};

// ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ‡ã‚Šæ›¿ãˆç”¨ï¼ˆæ•°å€¤ã‚’ä¸Šã’ã‚‹ã¨å³åæ˜ ï¼‰
window.APP_VERSION = 37;
</script>
<script>
/* ===== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
const V = (k)=> `${k}?v=${window.APP_VERSION||1}`;
const toSlug = s => (s||'').trim()
  .replace(/[ï¼ˆ(].*?[)ï¼‰]/g,'-')   // æ‹¬å¼§å†…ã‚’ãƒã‚¤ãƒ•ãƒ³
  .replace(/[^\p{L}\p{N}]+/gu,'-') // éè‹±æ•°ã‚’ãƒã‚¤ãƒ•ãƒ³
  .replace(/-+/g,'-').replace(/(^-|-$)/g,'');
const _baseName = s => (s||'').replace(/[ï¼ˆ(].*?[)ï¼‰]/g,'');

/* ===== ç”»åƒãƒ‘ã‚¹è§£æ±ºï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰å¯¾å¿œï¼‰ ===== */
function fishImg(f){
  const map = window.FISH_IMG_OVERRIDE || {};
  const keys = [f,_baseName(f),toSlug(f)];
  for(const k of keys){ if(map[k]) return V(map[k]); }
  return V(`img/fish-${toSlug(f)}.png`);
}
function rigImg(fish, method){
  const map = window.RIG_IMG_OVERRIDE || {};
  const keys = [
    `${fish}:${method}`,
    `${_baseName(fish)}:${method}`,
    `${toSlug(fish)}:${toSlug(method)}`
  ];
  for(const k of keys){
    if(map[k]){ const u = map[k]; return {specific:V(u),generic:V(u),placeholder:V(u)}; }
  }
  const m = toSlug(method)||"";
  return {
    specific:  V(`img/rig-${toSlug(fish)}-${m}.png`),
    generic:   V(`img/rig-${m}.png`),
    placeholder: "https://placehold.co/1200x600?text=Rig%20Illustration"
  };
}

/* ===== é‡£ã‚Šæ–¹â†’åŸºæœ¬æ¨å¥¨ã‚®ã‚¢(ç°¡æ˜“) ===== */
const GEAR_BY_METHOD = {
  "ã‚µãƒ“ã‚­":[
    {label:"ã‚µãƒ“ã‚­ä»•æ›ã‘ä¸€å¼", a:`https://www.amazon.co.jp/s?k=ã‚µãƒ“ã‚­+ä»•æ›ã‘&tag=YOURAMAZONTAG-22`,
                                   r:`https://search.rakuten.co.jp/search/mall/ã‚µãƒ“ã‚­%20ä»•æ›ã‘/`},
    {label:"ã‚³ãƒã‚»(ã‚¢ãƒŸå§«ãªã©)", a:`https://www.amazon.co.jp/s?k=ã‚¢ãƒŸå§«&tag=YOURAMAZONTAG-22`,
                                   r:`https://search.rakuten.co.jp/search/mall/ã‚¢ãƒŸå§«/`}
  ],
  "ãƒ«ã‚¢ãƒ¼":[
    {label:"ãƒŸãƒãƒ¼/ã‚·ãƒ³ãƒšãƒ³", a:`https://www.amazon.co.jp/s?k=ã‚·ãƒ¼ãƒã‚¹+ãƒŸãƒãƒ¼&tag=YOURAMAZONTAG-22`,
                                r:`https://search.rakuten.co.jp/search/mall/ã‚·ãƒ¼ãƒã‚¹%20ãƒŸãƒãƒ¼/`},
    {label:"ãƒ¡ã‚¿ãƒ«/ãƒã‚¤ãƒ–", a:`https://www.amazon.co.jp/s?k=ã‚·ãƒ¼ãƒã‚¹+ãƒã‚¤ãƒ–+ãƒ¡ã‚¿ãƒ«&tag=YOURAMAZONTAG-22`,
                             r:`https://search.rakuten.co.jp/search/mall/ã‚·ãƒ¼ãƒã‚¹%20ãƒã‚¤ãƒ–/`}
  ],
  "ã¡ã‚‡ã„æŠ•ã’":[
    {label:"ã¡ã‚‡ã„æŠ•ã’ä»•æ›ã‘ 5-8å·", a:`https://www.amazon.co.jp/s?k=ã¡ã‚‡ã„æŠ•ã’+ä»•æ›ã‘&tag=YOURAMAZONTAG-22`,
                                     r:`https://search.rakuten.co.jp/search/mall/ã¡ã‚‡ã„æŠ•ã’%20ä»•æ›ã‘/`}
  ],
  "èƒ´çªã":[
    {label:"èƒ´çªã/ãƒ–ãƒ©ã‚¯ãƒª", a:`https://www.amazon.co.jp/s?k=ãƒ–ãƒ©ã‚¯ãƒª+ä»•æ›ã‘&tag=YOURAMAZONTAG-22`,
                               r:`https://search.rakuten.co.jp/search/mall/ãƒ–ãƒ©ã‚¯ãƒª%20ä»•æ›ã‘/`}
  ],
  "ã‚¦ã‚­":[
    {label:"æ£’ã‚¦ã‚­/ç‰ã‚¦ã‚­", a:`https://www.amazon.co.jp/s?k=é‡£ã‚Š+æ£’ã‚¦ã‚­&tag=YOURAMAZONTAG-22`,
                            r:`https://search.rakuten.co.jp/search/mall/ç‰ã‚¦ã‚­/`}
  ]
};

/* ===== é­šã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ï¼ˆçŸ­ç¸®ç‰ˆãƒ»å¿…è¦ã«å¿œã˜ã¦è¿½è¨˜ã—ã¦ãã ã•ã„ï¼‰ ===== */
const FISH_BOOK = {
  "ã‚¢ã‚¸": { season:"åˆå¤ã€œç§‹ï¼ˆè¶Šå†¬ç¾¤ã‚‚ï¼‰", time:"æœå¤•ï¼å¤œ å¸¸å¤œç¯",
    shelf:"ä¸­å±¤ã€œåº•å¯„ã‚Šï¼ˆæ½®ç›®ãƒ»æ˜æš—ï¼‰",
    methods:["ã‚µãƒ“ã‚­","é æŠ•ã‚«ã‚´","ã¡ã‚‡ã„æŠ•ã’","ãƒ«ã‚¢ãƒ¼"],
    bait:["ã‚¢ãƒŸã‚¨ãƒ“","ã‚ªã‚­ã‚¢ãƒŸ","é’ã‚¤ã‚½ãƒ¡"],
    lures:["1â€“2gã‚¸ã‚°ãƒ˜ãƒƒãƒ‰ï¼‹ãƒ¯ãƒ¼ãƒ ","7â€“20gãƒ¡ã‚¿ãƒ«","ãƒ•ãƒ­ãƒ¼ãƒˆ"],
    food:"åˆºèº«ï¼ãªã‚ã‚ã†ï¼ãƒ•ãƒ©ã‚¤ï¼å—è›®æ¼¬ã‘"
  },
  "ã‚·ãƒ¼ãƒã‚¹": { season:"é€šå¹´ï¼ˆç§‹ã€œåˆå†¬æœ€ç››ï¼‰", time:"å¤•ãƒ»å¤œãƒ»æœãƒã‚ºãƒ¡",
    shelf:"è¡¨å±¤ã€œä¸­å±¤ï¼ˆæ‰•ã„å‡ºã—ãƒ»ãƒ¨ãƒ¬ãƒ»ãƒ–ãƒ¬ã‚¤ã‚¯ï¼‰",
    methods:["ãƒ«ã‚¢ãƒ¼","æ³³ãŒã›","ã¶ã£ã“ã¿","ã‚¦ã‚­"],   // é‡£ã‚Šæ–¹åˆ‡æ›¿ã«ä½¿ã†
    bait:["æ´»å°é­š/é’ã‚¤ã‚½ãƒ¡"],
    lures:["ãƒŸãƒãƒ¼120â€“140mm","ã‚·ãƒ³ãƒšãƒ³/ãƒã‚¤ãƒ–","30â€“40gã‚¸ã‚°"],
    food:"æ´—ã„ï¼åˆºèº«ï¼ãƒ ãƒ‹ã‚¨ãƒ«"
  },
  "ãƒã‚¼": { season:"å¤ã€œæ™©ç§‹", time:"æ—¥ä¸­ã€œå¤•ï¼ˆæº€ã¡å¼•ãå‰å¾Œï¼‰",
    shelf:"åº•ï¼ˆãƒŸã‚ªç­‹ãƒ»éšœå®³ç‰©éš›ï¼‰",
    methods:["ãƒŸãƒ£ã‚¯é‡£ã‚Š","ã‚¦ã‚­","ã¡ã‚‡ã„æŠ•ã’","ãƒã‚¼ã‚¯ãƒ©"],
    bait:["ã‚¢ã‚ªã‚¤ã‚½ãƒ¡","ã‚¨ãƒ“èº«","ãƒ›ã‚¿ãƒ†"],
    lures:["å°å‹ã‚¯ãƒ©ãƒ³ã‚¯","1gå‰å¾Œã‚¸ã‚°ãƒ˜ãƒƒãƒ‰"],
    food:"å¤©ã·ã‚‰ï¼å”æšã’ï¼ç”˜éœ²ç…®"
  },
  "ã‚«ã‚µã‚´": { season:"é€šå¹´ï¼ˆå†¬ã€œæ˜¥ãŒå¼·ã„ï¼‰", time:"å¤œï¼ˆæ˜¼ã¯ç©´æ’ƒã¡ï¼‰",
    shelf:"åº•ï¼ˆãƒ†ãƒˆãƒ©ãƒ»æ ¹ãƒ»å£éš›ï¼‰",
    methods:["èƒ´çªã","ãƒ–ãƒ©ã‚¯ãƒª","ãƒ†ã‚­ã‚µã‚¹","ç©´é‡£ã‚Š","ãƒ«ã‚¢ãƒ¼"],
    bait:["é’ã‚¤ã‚½ãƒ¡","ã‚µãƒåˆ‡èº«","ã‚ªã‚­ã‚¢ãƒŸ"],
    lures:["ãƒ†ã‚­ã‚µã‚¹ï¼‹ã‚¯ãƒ­ãƒ¼/ãƒ›ãƒƒã‚°","ã‚¸ã‚°ãƒ˜ãƒƒãƒ‰"],
    food:"å”æšã’ï¼å‘³å™Œæ±ï¼ç…®ä»˜ã‘"
  }
};

/* ===== å ´æ‰€ãƒ‡ãƒ¼ã‚¿ï¼ˆæ±äº¬éƒ½ä¾‹ãƒ»è¿½è¨˜OKï¼‰ ===== */
const PLACES = {
  "æ±äº¬éƒ½":[
    { name:"è‹¥æ´²æµ·æµœå…¬åœ’ï¼ˆæµ·é‡£ã‚Šæ–½è¨­ãƒ»äººå·¥ç£¯ï¼‰", area:"æ±Ÿæ±åŒºè‹¥æ´²3ä¸ç›®",
      map:"https://maps.google.com/?q=è‹¥æ´²æµ·æµœå…¬åœ’%20æµ·é‡£ã‚Šæ–½è¨­",
      fishes:["ã‚¢ã‚¸","ã‚¤ã‚·ãƒ¢ãƒ","ã‚³ãƒã‚·ãƒ­","ãƒ¡ãƒãƒ«","ã‚«ã‚µã‚´","ã‚·ãƒ¼ãƒã‚¹","ãƒã‚¼"],
      memo:"æŸµãƒ»å£²åº—ãƒ»ãƒˆã‚¤ãƒ¬ã‚ã‚Šã€‚æ··é›‘å¤šã‚ï¼ãƒ©ã‚¤ã‚¸ãƒ£ã‚±æ¨å¥¨ã€‚"
    },
    { name:"è±Šæ´²ãã‚‹ã‚Šå…¬åœ’ï¼ˆè­·å²¸ï¼‰", area:"æ±Ÿæ±åŒºè±Šæ´²6ä¸ç›®ã»ã‹",
      map:"https://maps.google.com/?q=è±Šæ´²ãã‚‹ã‚Šå…¬åœ’",
      fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ãƒ¡ãƒãƒ«","ã‚«ã‚µã‚´","ã‚¯ãƒ­ãƒ€ã‚¤","ã‚µãƒ¨ãƒª"],
      memo:"ç¦æ­¢åŒºç”»ã‚ã‚Šãƒ»æ’’ãé¤Œã‚„ãƒ­ã‚±ãƒƒãƒˆå¤©ç§¤ç¦æ­¢ï¼æ­©è¡Œè€…æœ€å„ªå…ˆã€‚"
    },
    { name:"ç ‚ç”ºæ°´è¾ºå…¬åœ’ï¼ˆè’å·ï¼‰", area:"æ±Ÿæ±åŒºæ±ç ‚7ã€œ8ä¸ç›®",
      map:"https://maps.google.com/?q=ç ‚ç”ºæ°´è¾ºå…¬åœ’",
      fishes:["ãƒã‚¼","ã‚·ãƒ¼ãƒã‚¹","ã‚¯ãƒ­ãƒ€ã‚¤","ãƒœãƒ©"],
      memo:"ã‚´ãƒ­ã‚¿ã§æ ¹æ›ã‹ã‚Šãƒ»æ»‘ã‚Šæ³¨æ„ï¼ãƒˆã‚¤ãƒ¬ç‚¹åœ¨ã€‚"
    },
    { name:"å¤§äº•ãµé ­ä¸­å¤®æµ·æµœå…¬åœ’ï¼ˆãªãã•ã®æ£®ï¼‰", area:"å“å·åŒºå…«æ½®4-2-1 å‘¨è¾º",
      map:"https://maps.google.com/?q=å¤§äº•ãµé ­ä¸­å¤®æµ·æµœå…¬åœ’%20ãªãã•ã®æ£®",
      fishes:["ãƒã‚¼","ã‚»ã‚¤ã‚´","ã‚·ãƒ¼ãƒã‚¹"],
      memo:"ç«‹å…¥ãƒ»é‡£ã‚Šç¦æ­¢åŒºç”»ã‚ã‚Šï¼æµ·ä¸Šå…¬åœ’ã¯æŠ•ã’åŸå‰‡ç¦æ­¢ï¼ˆã‚¢ãƒ³ãƒ€ãƒ¼æ¨å¥¨ï¼‰ã€‚"
    }
  ]
};

/* ===== çœŒãƒªã‚¹ãƒˆï¼ˆä¸Šã‹ã‚‰é †ã«è¡¨ç¤ºï¼‰ ===== */
const PREFS = Object.keys(PLACES);
                       </script>
</head>
<body>
<header>
  <div class="brand"><i></i>RigNavi<div class="badge">MVP</div></div>
</header>

<!-- â˜… ãƒã‚¦ã‚¹åºƒå‘Šï¼ˆä¸Šéƒ¨å›ºå®šé ˜åŸŸï¼‰ -->
<div class="banner" id="houseBanner">
  <a href="articles/sample-article.html" target="_blank" rel="noopener">
    <!-- ä»»æ„ã®ç”»åƒã‚’ img/house-ad.jpg ã«ã‚¢ãƒƒãƒ—ã—ã¦ä¸‹ã•ã„ -->
    <img src="img/house-ad.jpg" alt="ãŠã™ã™ã‚è¨˜äº‹ / ãƒã‚¦ã‚¹åºƒå‘Š">
  </a>
  <div class="small">â€»ç”»åƒãŒå‡ºãªã„å ´åˆã¯ <code>img/house-ad.jpg</code> ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚</div>
</div>

<main>
  <div id="hello">èµ·å‹•ä¸­â€¦</div>

  <div class="row">
    <section class="steps">
      <div class="card">
        <div class="row" style="gap:10px">
          <div class="stepCard"><b>1</b><h4>éƒ½é“åºœçœŒ</h4></div>
          <div class="stepCard"><b>2</b><h4>é‡£ã‚Šå ´</h4></div>
          <div class="stepCard"><b>3</b><h4>é­šç¨®</h4></div>
          <div class="stepCard"><b>4</b><h4>ä»•æ›ã‘/æƒ…å ±</h4></div>
        </div>

        <div class="sectionTitle">éƒ½é“åºœçœŒã‚’é¸æŠ</div>
        <div id="list-pref" class="tiles"></div>

        <div class="sectionTitle">é‡£ã‚Šå ´ã‚’é¸æŠ</div>
        <div id="list-place" class="tiles"></div>

        <div class="sectionTitle">é­šç¨®ã‚’é¸æŠ</div>
        <div id="list-fish" class="tiles"></div>
      </div>
    </section>

    <section class="detail">
      <div class="card" id="detailCard">
        <div class="small">å·¦ã§éƒ½é“åºœçœŒ â†’ é‡£ã‚Šå ´ â†’ é­šç¨®ã®é †ã«é¸ã‚“ã§ãã ã•ã„ã€‚</div>
      </div>
    </section>
  </div>
</main>

<script>
/* ====== UI(ç”Ÿæˆ) ====== */
const el = id => document.getElementById(id);

function renderPrefs(){
  const box = el('list-pref'); box.innerHTML='';
  PREFS.forEach(p=>{
    const d=document.createElement('div');
    d.className='tile';
    d.innerHTML=`<h5>${p}</h5><div class="meta">é‡£ã‚Šå ´ï¼š${PLACES[p].length}ä»¶</div>`;
    d.onclick=()=>{ state.pref=p; state.place=null; state.fish=null; renderPlaces(); renderFishes(); renderDetail(); };
    box.appendChild(d);
  });
}
function renderPlaces(){
  const box = el('list-place'); box.innerHTML='';
  if(!state.pref){ box.innerHTML='<div class="small">â€» å…ˆã«éƒ½é“åºœçœŒã‚’é¸æŠ</div>'; return; }
  PLACES[state.pref].forEach(p=>{
    const d=document.createElement('div');
    d.className='tile';
    const fishTxt = (p.fishes||[]).slice(0,6).join('ã€');
    d.innerHTML = `
      <h5>${p.name}</h5>
      <div class="meta">${state.pref}ï¼${p.area}</div>
      <div class="memo">ä¸€å£ãƒ¡ãƒ¢ï¼š${p.memo||"â€”"}</div>
      <div class="small" style="margin-top:6px"><a href="${p.map}" target="_blank">ğŸ“Googleãƒãƒƒãƒ—</a>ãƒ»é‡£ã‚Œã‚‹é­šï¼š${fishTxt||"â€”"}</div>
    `;
    d.onclick=()=>{ state.place=p; state.fish=null; renderFishes(); renderDetail(); };
    box.appendChild(d);
  });
}
function renderFishes(){
  const box = el('list-fish'); box.innerHTML='';
  if(!state.place){ box.innerHTML='<div class="small">â€» å…ˆã«é‡£ã‚Šå ´ã‚’é¸æŠ</div>'; return; }
  const fishes = (state.place.fishes||[]).filter(f=>FISH_BOOK[f]);
  if(!fishes.length){ box.innerHTML='<div class="small">ãƒ‡ãƒ¼ã‚¿æº–å‚™ä¸­</div>'; return; }
  fishes.forEach(f=>{
    const d=document.createElement('div');
    d.className='tile';
    d.innerHTML = `<h5>${f}</h5><div class="meta">${FISH_BOOK[f].season}</div>`;
    d.onclick=()=>{ state.fish=f; renderDetail(); };
    box.appendChild(d);
  });
}

function chip(name,sel){ return `<span class="chip ${sel?'sel':''}" data-m="${name}">${name}</span>`; }

function renderDetail(){
  const wrap = el('detailCard');
  if(!state.place || !state.fish){
    wrap.innerHTML = `<div class="small">â€» é‡£ã‚Šå ´ã¨é­šç¨®ã‚’é¸ã¶ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>`;
    return;
  }
  const fish = state.fish, data = FISH_BOOK[fish];
  const imgFish = fishImg(fish);
  const methods = (data.methods||[]);
  if(!state.method || !methods.includes(state.method)){ state.method = methods[0]||""; }
  const rig = rigImg(fish, state.method);

  wrap.innerHTML = `
    <h3 style="margin-top:0">${fish}</h3>
    <div class="params">
      <div class="param"><b>å­£</b>${data.season||'â€”'}</div>
      <div class="param"><b>æ™‚</b>${data.time||'â€”'}</div>
      <div class="param"><b>æ£š</b>${data.shelf||'â€”'}</div>
    </div>

    <div class="sectionTitle">æŒ‡å®šã—ãŸé­šç”»åƒ</div>
    <img class="heroImg" src="${imgFish}" alt="${fish}">

    <div class="sectionTitle">é‡£ã‚Šæ–¹</div>
    <div class="method-chips">
      ${methods.map(m=>chip(m, m===state.method)).join('')}
    </div>

    <div class="sectionTitle">ä»•æ›ã‘ã‚¤ãƒ©ã‚¹ãƒˆï¼ˆ${state.method||'â€”'}ï¼‰</div>
    <img class="heroImg" src="${rig.specific}" onerror="this.src='${rig.generic}'; this.onerror=null;" alt="Rig">

    <div class="sectionTitle">ã‚ªã‚¹ã‚¹ãƒ¡éƒ¨æ</div>
    <div id="gearList"></div>

    <div class="sectionTitle">ã‚¨ã‚µï¼ãƒ«ã‚¢ãƒ¼</div>
    <div class="small">ã‚¨ã‚µï¼š${(data.bait||[]).join('ã€')||'â€”'}</div>
    <div class="small">ãƒ«ã‚¢ãƒ¼ï¼š${(data.lures||[]).join('ã€')||'â€”'}</div>

    <div class="sectionTitle">ç‹™ã„ç›®ã®æ£šãƒ»æ™‚é–“å¸¯</div>
    <div class="small">æ£šï¼š${data.shelf||'â€”'}</div>
    <div class="small">æ™‚é–“ï¼š${data.time||'â€”'}</div>

    <div class="sectionTitle">é£Ÿã¹æ–¹ãƒ¡ãƒ¢</div>
    <div class="small">${data.food||'â€”'}</div>

    <div class="actions">
      <a class="button ghost" href="${state.place.map}" target="_blank">ğŸ“ å ´æ‰€ã‚’åœ°å›³ã§ç¢ºèª</a>
      <button class="button" id="shareBtn">å‹ã ã¡ã«å…±æœ‰</button>
    </div>
    <div class="small">é‡£ã‚Šå ´ï¼š${state.place.name}ï¼ˆ${state.place.area}ï¼‰</div>
  `;

  // é‡£ã‚Šæ–¹ãƒãƒƒãƒ—ã®ã‚¯ãƒªãƒƒã‚¯
  wrap.querySelectorAll('.chip').forEach(c=>{
    c.onclick = ()=>{ state.method = c.dataset.m; renderDetail(); };
  });

  // ã‚®ã‚¢ï¼ˆé‡£ã‚Šæ–¹ã«å¿œã˜ã¦ï¼‰
  const gears = (GEAR_BY_METHOD[state.method]||[]);
  const gBox = wrap.querySelector('#gearList');
  gBox.innerHTML = gears.length
    ? gears.map(g=>`<div class="param" style="gap:12px"><b>${state.method}</b>${g.label}ã€€
        <a href="${g.a}" target="_blank">Amazon</a>ï¼<a href="${g.r}" target="_blank">æ¥½å¤©</a></div>`).join('')
    : '<div class="small">æº–å‚™ä¸­</div>';

  // å…±æœ‰
  const btn = wrap.querySelector('#shareBtn');
  btn.onclick = async ()=>{
    try{
      await liff.shareTargetPicker([{
        type:'text',
        text:`${state.place.name}ã§ã€Œ${fish}ã€ã‚’${state.method}ã§ç‹™ã†ï¼\nåœ°å›³: ${state.place.map}`
      }]);
    }catch(e){ /*é–‰ã˜ãŸã ã‘*/ }
  };
}

/* ====== çŠ¶æ…‹ ====== */
const state = { pref:null, place:null, fish:null, method:null };

/* ====== LIFF Init ====== */
(async ()=>{
  try{
    await liff.init({ liffId: "2008257307-RwPLYWG1" });
    if(!liff.isLoggedIn()){ liff.login(); return; }
    const p = await liff.getProfile();
    el('hello').textContent = `ã‚ˆã†ã“ã ${p.displayName} ã•ã‚“`;
  }catch(e){
    el('hello').textContent = "Webã¨ã—ã¦é–²è¦§ä¸­ï¼ˆLIFFæœªãƒ­ã‚°ã‚¤ãƒ³ï¼‰";
  }finally{
    renderPrefs(); renderPlaces(); renderFishes(); renderDetail();
  }
})();
</script>
</body>
</html>
